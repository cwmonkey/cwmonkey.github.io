!function(){var e,t=!1;window.cwmMakeNote.load=function(n,a,i){e=a,t=i,n.cwmMakeNote.main=o};var o=function(){function o(e){var t=e.changedTouches[0],o=document.createEvent("MouseEvent");o.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(o),e.preventDefault()}var n={},a=new window.cwmMakeNoteApp(e,t);a.attach();var i=function(e,t){l.contentWindow.postMessage({type:"save_note",id:e,note:t},"*")},d=function(e){if("string"!=typeof e.data&&console.log("main",e.data),e.origin==document.location.protocol+"//{{ site.domain }}")if("loaded"===e.data.type)c.addClass("__make-note_loaded").attr("scrolling","yes"),e.data.tpls.forEach(function(e){n[e.name]=a.tpl(e.html)});else if("destroy"===e.data.type)c.remove();else if("open"===e.data.type)c.addClass("__make-note_opened"),c[0].scrolling="auto",c.attr({scrolling:"auto"});else if("close"===e.data.type)c.removeClass("__make-note_opened"),c[0].scrolling="no",c.attr({scrolling:"no"});else if("toWindow"===e.data.type){cwmMakeNote.notes[e.data.id]&&(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id]),e.data.note.id=e.data.id;var t=new window.cwmMakeNote.Note(e.data.note,n["note-tpl"],n["note-form-tpl"],i,l.contentWindow);t.$el.appendTo(document.body),cwmMakeNote.notes[e.data.id]=t}else"toList"===e.data.type&&cwmMakeNote.notes[e.data.id]?(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id]):"delete"===e.data.type&&cwmMakeNote.notes[e.data.id]&&(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id])};window.addEventListener("message",d,!1);var s=e('<link rel="stylesheet" id="__make-note-css"/>');s.attr({href:"//{{ site.domain }}/css/make-note.css"}),s.appendTo(document.head);var c=e('<iframe id="__make-note" scrolling="no" style="display: none; opacity: 0"></iframe>'),l=c[0];c.attr({src:"//{{ site.domain }}/greasemonkey/make-note/make-note-iframe.html#"+document.location.href}),c.appendTo(document.body),setTimeout(function(){c.addClass("__make-note_opened"),c[0].scrolling="auto",c.attr({scrolling:"auto"}),setTimeout(function(){c.removeClass("__make-note_opened"),c[0].scrolling="no",c.attr({scrolling:"no"})},0)},0),function(e){for(var t,o=function(e){var t;document.createEvent?(t=document.createEvent("HTMLEvents"),t.initEvent(e,!0,!0)):(t=document.createEventObject(),t.eventType=e),t.eventName=e,document.createEvent?window.dispatchEvent(t):window.fireEvent("on"+t.eventType,t)},n={},a=["pushState","replaceState"],i=0,d=a.length;d>i;i++)t=a[i],n[t]=e[t],e[t]=function(t){return function(){var a=n[t].apply(e,arguments);return o(t.toLowerCase()),a}}(t)}(window.history);var m=function(){l.contentWindow.postMessage({type:"url_change",url:document.location.href},"*")};window.addEventListener("popstate",m),window.addEventListener("pushstate",m),window.addEventListener("replacestate",m),document.addEventListener("touchstart",o,!0),document.addEventListener("touchmove",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("touchcancel",o,!0);var u,r,v,p,h,w,f,g,k,y,_,M,E,N,b=e(window),L=e(document.body),C=0,T=0,x=0,$=0,W=0,X=0,Y=0,H=0,I=function(){0>=$&&($=0),h.absolute||(k=b.height(),y=v.outerHeight(!0),y>k&&(v.css({height:k}),u=k),$+y>k&&($=k-y)),0>=x&&(x=0),h.absolute||(M=b.width(),E=v.outerWidth(!0),E>M&&(v.css({width:M}),r=M),x+E>M&&(x=M-E))},S=function(e){$=e.clientY-T,x=e.clientX-C,I(),p.style.top=$+"px",p.style.left=x+"px"},j=function(e){H=e.clientY-X,g.absolute||(k=b.height(),_=parseInt(w.css("top")),_+H>k&&(H=k-_)),f.style.height=H+"px",Y=e.clientX-W,g.absolute||(M=b.width(),N=parseInt(w.css("left")),N+Y>M&&(Y=M-N)),f.style.width=Y+"px"},z=function(){I();var e=h;b.unbind("mousemove",S),L.removeClass("__make-note--moving").unbind("mouseup mouseleave",z),e.editing||(0>=x?(e.x=void 0,p.style.left="0"):e.x=x,0>=$?(e.y=void 0,p.style.top="0"):e.y=$,r&&(e.width=r),u&&(e.height=u),i(e.id,e.export()))},A=function(){var e=cwmMakeNote.get_node(f);b.unbind("mousemove",j),L.unbind("mouseup mouseleave",A),e.editing||(0>=Y?(e.width=void 0,p.style.left="0"):e.width=Y,0>=H?(e.height=void 0,p.style.height="0"):e.height=H,i(e.id,e.export()))};e(document).delegate(".__make-note--note","focusin",function(){e(this).addClass("__make-note--focused")}).delegate(".__make-note--note","focusout",function(){e(this).removeClass("__make-note--focused")}).delegate('[data-type="mover"]',"mousedown",function(e){1===event.which&&(h=cwmMakeNote.get_node(this),v=h.$el,p=v[0],C=e.clientX-p.offsetLeft,T=e.clientY-p.offsetTop,u=void 0,b.bind("mousemove",S),L.addClass("__make-note--moving").bind("mouseup mouseleave",z))}).delegate('[data-type="resize"]',"mousedown",function(e){1===event.which&&(g=cwmMakeNote.get_node(this),w=g.$el,f=w[0],W=e.clientX-w.outerWidth(!0),X=e.clientY-w.outerHeight(!0),b.bind("mousemove",j),L.bind("mouseup mouseleave",A))}).delegate('[data-type="to-list"]',"click",function(){cwmMakeNote.get_node(this).toList(),cwmMakeNote.get_node(this).$el.remove()})}}();