!function(){var e,t,o=!1;window.cwmMakeNote.load=function(a,i,d,s){e=i,t=d,o=s,a.cwmMakeNote.main=n};var n=function(){function n(e){var t=e.changedTouches[0],o=document.createEvent("MouseEvent");o.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(o),e.preventDefault()}var a={},i=new window.cwmMakeNoteApp(e,t,o),d=320,s="__make-note-width";try{d=parseInt(localStorage.getItem(s))||d}catch(c){}i.attach();var l=function(e,t){p.contentWindow.postMessage({type:"save_note",id:e,note:t},"*")},m=function(e){if("string"!=typeof e.data&&console.log("main",e.data),e.origin==document.location.protocol+"//{{ site.domain }}")if("loaded"===e.data.type)u.addClass("__make-note_loaded").attr("scrolling","yes"),e.data.tpls.forEach(function(e){a[e.name]=i.tpl(e.html)});else if("destroy"===e.data.type)u.remove();else if("wider"===e.data.type)d+=20,u.width(d),localStorage.setItem(s,d);else if("thinner"===e.data.type)d-=20,100>d&&(d=100),u.width(d),localStorage.setItem(s,d);else if("open"===e.data.type)u.addClass("__make-note_opened"),u[0].scrolling="auto",u.attr({scrolling:"auto"});else if("close"===e.data.type)u.removeClass("__make-note_opened"),u[0].scrolling="no",u.attr({scrolling:"no"});else if("toWindow"===e.data.type){cwmMakeNote.notes[e.data.id]&&(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id]),e.data.note.id=e.data.id;var t=new window.cwmMakeNote.Note(e.data.note,a["note-tpl"],a["note-form-tpl"],l,p.contentWindow);t.$el.appendTo(document.body),cwmMakeNote.notes[e.data.id]=t}else"toList"===e.data.type&&cwmMakeNote.notes[e.data.id]?(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id]):"delete"===e.data.type&&cwmMakeNote.notes[e.data.id]&&(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id])};window.addEventListener("message",m,!1);var r=e('<link rel="stylesheet" id="__make-note-css"/>');r.attr({href:"//{{ site.domain }}/css/make-note.css"}),r.appendTo(document.head);var u=e('<iframe id="__make-note" scrolling="no" style="display: none; opacity: 0; width: '+d+'px"></iframe>'),p=u[0];u.attr({src:"//{{ site.domain }}/greasemonkey/make-note/make-note-iframe.html#"+document.location.href}),u.appendTo(document.body),setTimeout(function(){u.addClass("__make-note_opened"),u[0].scrolling="auto",u.attr({scrolling:"auto"}),setTimeout(function(){u.removeClass("__make-note_opened"),u[0].scrolling="no",u.attr({scrolling:"no"})},0)},0),function(e){for(var t,o=function(e){var t;document.createEvent?(t=document.createEvent("HTMLEvents"),t.initEvent(e,!0,!0)):(t=document.createEventObject(),t.eventType=e),t.eventName=e,document.createEvent?window.dispatchEvent(t):window.fireEvent("on"+t.eventType,t)},n={},a=["pushState","replaceState"],i=0,d=a.length;d>i;i++)t=a[i],n[t]=e[t],e[t]=function(t){return function(){var a=n[t].apply(e,arguments);return o(t.toLowerCase()),a}}(t)}(window.history);var v=function(){p.contentWindow.postMessage({type:"url_change",url:document.location.href},"*")};window.addEventListener("popstate",v),window.addEventListener("pushstate",v),window.addEventListener("replacestate",v),document.addEventListener("touchstart",n,!0),document.addEventListener("touchmove",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("touchcancel",n,!0);var h,w,f,g,y,_,k,M,E,N,b,L,C,T,x=e(window),$=e(document.body),I=0,W=0,X=0,Y=0,S=0,H=0,j=0,z=0,A=function(){0>=Y&&(Y=0),y.absolute||(E=x.height(),N=f.outerHeight(!0),N>E&&(f.css({height:E}),h=E),Y+N>E&&(Y=E-N)),0>=X&&(X=0),y.absolute||(L=x.width(),C=f.outerWidth(!0),C>L&&(f.css({width:L}),w=L),X+C>L&&(X=L-C))},D=function(e){Y=e.clientY-W,X=e.clientX-I,A(),g.style.top=Y+"px",g.style.left=X+"px"},O=function(e){z=e.clientY-H,M.absolute||(E=x.height(),b=parseInt(_.css("top")),b+z>E&&(z=E-b)),k.style.height=z+"px",j=e.clientX-S,M.absolute||(L=x.width(),T=parseInt(_.css("left")),T+j>L&&(j=L-T)),k.style.width=j+"px"},q=function(){A();var e=y;x.unbind("mousemove",D),$.removeClass("__make-note--moving").unbind("mouseup mouseleave",q),e.editing||(0>=X?(e.x=void 0,g.style.left="0"):e.x=X,0>=Y?(e.y=void 0,g.style.top="0"):e.y=Y,w&&(e.width=w),h&&(e.height=h),l(e.id,e.export()))},B=function(){var e=cwmMakeNote.get_node(k);x.unbind("mousemove",O),$.unbind("mouseup mouseleave",B),e.editing||(0>=j?(e.width=void 0,g.style.left="0"):e.width=j,0>=z?(e.height=void 0,g.style.height="0"):e.height=z,l(e.id,e.export()))};e(document).delegate(".__make-note--note","focusin",function(){e(this).addClass("__make-note--focused")}).delegate(".__make-note--note","focusout",function(){e(this).removeClass("__make-note--focused")}).delegate('[data-type="mover"]',"mousedown",function(e){1===event.which&&(y=cwmMakeNote.get_node(this),f=y.$el,g=f[0],I=e.clientX-g.offsetLeft,W=e.clientY-g.offsetTop,h=void 0,x.bind("mousemove",D),$.addClass("__make-note--moving").bind("mouseup mouseleave",q))}).delegate('[data-type="resize"]',"mousedown",function(e){1===event.which&&(M=cwmMakeNote.get_node(this),_=M.$el,k=_[0],S=e.clientX-_.outerWidth(!0),H=e.clientY-_.outerHeight(!0),x.bind("mousemove",O),$.bind("mouseup mouseleave",B))}).delegate('[data-type="to-list"]',"click",function(){cwmMakeNote.get_node(this).toList(),cwmMakeNote.get_node(this).$el.remove()})}}();