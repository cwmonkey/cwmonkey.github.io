!function(){var e,t=!1;window.cwmMakeNote.load=function(n,a,i){e=a,t=i,n.cwmMakeNote.main=o};var o=function(){function o(e){var t=e.changedTouches[0],o=document.createEvent("MouseEvent");o.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(o),e.preventDefault()}var n={},a=new window.cwmMakeNoteApp(e,t),i=320,d="__make-note-width";try{i=parseInt(localStorage.getItem(d))||i}catch(s){}a.attach();var c=function(e,t){u.contentWindow.postMessage({type:"save_note",id:e,note:t},"*")},l=function(e){if("string"!=typeof e.data&&console.log("main",e.data),e.origin==document.location.protocol+"//{{ site.domain }}")if("loaded"===e.data.type)r.addClass("__make-note_loaded").attr("scrolling","yes"),e.data.tpls.forEach(function(e){n[e.name]=a.tpl(e.html)});else if("destroy"===e.data.type)r.remove();else if("wider"===e.data.type)i+=20,r.width(i),localStorage.setItem(d,i);else if("thinner"===e.data.type)i-=20,100>i&&(i=100),r.width(i),localStorage.setItem(d,i);else if("open"===e.data.type)r.addClass("__make-note_opened"),r[0].scrolling="auto",r.attr({scrolling:"auto"});else if("close"===e.data.type)r.removeClass("__make-note_opened"),r[0].scrolling="no",r.attr({scrolling:"no"});else if("toWindow"===e.data.type){cwmMakeNote.notes[e.data.id]&&(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id]),e.data.note.id=e.data.id;var t=new window.cwmMakeNote.Note(e.data.note,n["note-tpl"],n["note-form-tpl"],c,u.contentWindow);t.$el.appendTo(document.body),cwmMakeNote.notes[e.data.id]=t}else"toList"===e.data.type&&cwmMakeNote.notes[e.data.id]?(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id]):"delete"===e.data.type&&cwmMakeNote.notes[e.data.id]&&(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id])};window.addEventListener("message",l,!1);var m=e('<link rel="stylesheet" id="__make-note-css"/>');m.attr({href:"//{{ site.domain }}/css/make-note.css"}),m.appendTo(document.head);var r=e('<iframe id="__make-note" scrolling="no" style="display: none; opacity: 0; width: '+i+'px"></iframe>'),u=r[0];r.attr({src:"//{{ site.domain }}/greasemonkey/make-note/make-note-iframe.html#"+document.location.href}),r.appendTo(document.body),setTimeout(function(){r.addClass("__make-note_opened"),r[0].scrolling="auto",r.attr({scrolling:"auto"}),setTimeout(function(){r.removeClass("__make-note_opened"),r[0].scrolling="no",r.attr({scrolling:"no"})},0)},0),function(e){for(var t,o=function(e){var t;document.createEvent?(t=document.createEvent("HTMLEvents"),t.initEvent(e,!0,!0)):(t=document.createEventObject(),t.eventType=e),t.eventName=e,document.createEvent?window.dispatchEvent(t):window.fireEvent("on"+t.eventType,t)},n={},a=["pushState","replaceState"],i=0,d=a.length;d>i;i++)t=a[i],n[t]=e[t],e[t]=function(t){return function(){var a=n[t].apply(e,arguments);return o(t.toLowerCase()),a}}(t)}(window.history);var p=function(){u.contentWindow.postMessage({type:"url_change",url:document.location.href},"*")};window.addEventListener("popstate",p),window.addEventListener("pushstate",p),window.addEventListener("replacestate",p),document.addEventListener("touchstart",o,!0),document.addEventListener("touchmove",o,!0),document.addEventListener("touchend",o,!0),document.addEventListener("touchcancel",o,!0);var v,h,w,f,g,y,_,k,M,E,N,b,L,C,T=e(window),x=e(document.body),$=0,I=0,W=0,X=0,Y=0,S=0,H=0,j=0,z=function(){0>=X&&(X=0),g.absolute||(M=T.height(),E=w.outerHeight(!0),E>M&&(w.css({height:M}),v=M),X+E>M&&(X=M-E)),0>=W&&(W=0),g.absolute||(b=T.width(),L=w.outerWidth(!0),L>b&&(w.css({width:b}),h=b),W+L>b&&(W=b-L))},A=function(e){X=e.clientY-I,W=e.clientX-$,z(),f.style.top=X+"px",f.style.left=W+"px"},D=function(e){j=e.clientY-S,k.absolute||(M=T.height(),N=parseInt(y.css("top")),N+j>M&&(j=M-N)),_.style.height=j+"px",H=e.clientX-Y,k.absolute||(b=T.width(),C=parseInt(y.css("left")),C+H>b&&(H=b-C)),_.style.width=H+"px"},O=function(){z();var e=g;T.unbind("mousemove",A),x.removeClass("__make-note--moving").unbind("mouseup mouseleave",O),e.editing||(0>=W?(e.x=void 0,f.style.left="0"):e.x=W,0>=X?(e.y=void 0,f.style.top="0"):e.y=X,h&&(e.width=h),v&&(e.height=v),c(e.id,e.export()))},q=function(){var e=cwmMakeNote.get_node(_);T.unbind("mousemove",D),x.unbind("mouseup mouseleave",q),e.editing||(0>=H?(e.width=void 0,f.style.left="0"):e.width=H,0>=j?(e.height=void 0,f.style.height="0"):e.height=j,c(e.id,e.export()))};e(document).delegate(".__make-note--note","focusin",function(){e(this).addClass("__make-note--focused")}).delegate(".__make-note--note","focusout",function(){e(this).removeClass("__make-note--focused")}).delegate('[data-type="mover"]',"mousedown",function(e){1===event.which&&(g=cwmMakeNote.get_node(this),w=g.$el,f=w[0],$=e.clientX-f.offsetLeft,I=e.clientY-f.offsetTop,v=void 0,T.bind("mousemove",A),x.addClass("__make-note--moving").bind("mouseup mouseleave",O))}).delegate('[data-type="resize"]',"mousedown",function(e){1===event.which&&(k=cwmMakeNote.get_node(this),y=k.$el,_=y[0],Y=e.clientX-y.outerWidth(!0),S=e.clientY-y.outerHeight(!0),T.bind("mousemove",D),x.bind("mouseup mouseleave",q))}).delegate('[data-type="to-list"]',"click",function(){cwmMakeNote.get_node(this).toList(),cwmMakeNote.get_node(this).$el.remove()})}}();