!function(){var e,t,o=!1;window.cwmMakeNote.load=function(a,i,d,s){e=i,o=d,a.cwmMakeNote.main=n,t=s};var n=function(){function n(e){var t=e.changedTouches[0],o=document.createEvent("MouseEvent");o.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[e.type],!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),t.target.dispatchEvent(o),e.preventDefault()}var a={},i=new window.cwmMakeNoteApp(e,t,o);i.attach();var d=function(e,t){m.contentWindow.postMessage({type:"save_note",id:e,note:t},"*")},s=function(e){if("string"!=typeof e.data&&console.log("main",e.data),e.origin==document.location.protocol+"//{{ site.domain }}")if("loaded"===e.data.type)l.addClass("__make-note_loaded").attr("scrolling","yes"),e.data.tpls.forEach(function(e){a[e.name]=i.tpl(e.html)});else if("destroy"===e.data.type)l.remove();else if("open"===e.data.type)l.addClass("__make-note_opened"),l[0].scrolling="auto",l.attr({scrolling:"auto"});else if("close"===e.data.type)l.removeClass("__make-note_opened"),l[0].scrolling="no",l.attr({scrolling:"no"});else if("toWindow"===e.data.type){cwmMakeNote.notes[e.data.id]&&(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id]),e.data.note.id=e.data.id;var t=new window.cwmMakeNote.Note(e.data.note,a["note-tpl"],a["note-form-tpl"],d,m.contentWindow);t.$el.appendTo(document.body),cwmMakeNote.notes[e.data.id]=t}else"toList"===e.data.type&&cwmMakeNote.notes[e.data.id]?(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id]):"delete"===e.data.type&&cwmMakeNote.notes[e.data.id]&&(cwmMakeNote.notes[e.data.id].$el.remove(),delete cwmMakeNote.notes[e.data.id])};window.addEventListener("message",s,!1);var c=e('<link rel="stylesheet" id="__make-note-css"/>');c.attr({href:"//{{ site.domain }}/css/make-note.css"}),c.appendTo(document.head);var l=e('<iframe id="__make-note" scrolling="no" style="display: none; opacity: 0"></iframe>'),m=l[0];l.attr({src:"//{{ site.domain }}/greasemonkey/make-note/make-note-iframe.html#"+document.location.href}),l.appendTo(document.body),setTimeout(function(){l.addClass("__make-note_opened"),l[0].scrolling="auto",l.attr({scrolling:"auto"}),setTimeout(function(){l.removeClass("__make-note_opened"),l[0].scrolling="no",l.attr({scrolling:"no"})},0)},0),function(e){for(var t,o=function(e){var t;document.createEvent?(t=document.createEvent("HTMLEvents"),t.initEvent(e,!0,!0)):(t=document.createEventObject(),t.eventType=e),t.eventName=e,document.createEvent?window.dispatchEvent(t):window.fireEvent("on"+t.eventType,t)},n={},a=["pushState","replaceState"],i=0,d=a.length;d>i;i++)t=a[i],n[t]=e[t],e[t]=function(t){return function(){var a=n[t].apply(e,arguments);return o(t.toLowerCase()),a}}(t)}(window.history);var u=function(){m.contentWindow.postMessage({type:"url_change",url:document.location.href},"*")};window.addEventListener("popstate",u),window.addEventListener("pushstate",u),window.addEventListener("replacestate",u),document.addEventListener("touchstart",n,!0),document.addEventListener("touchmove",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("touchcancel",n,!0);var r,v,p,h,w,f,g,k,y,_,M,E,N,b,L=e(window),C=e(document.body),T=0,x=0,$=0,W=0,X=0,Y=0,H=0,I=0,S=function(){0>=W&&(W=0),w.absolute||(y=L.height(),_=p.outerHeight(!0),_>y&&(p.css({height:y}),r=y),W+_>y&&(W=y-_)),0>=$&&($=0),w.absolute||(E=L.width(),N=p.outerWidth(!0),N>E&&(p.css({width:E}),v=E),$+N>E&&($=E-N))},j=function(e){W=e.clientY-x,$=e.clientX-T,S(),h.style.top=W+"px",h.style.left=$+"px"},z=function(e){I=e.clientY-Y,k.absolute||(y=L.height(),M=parseInt(f.css("top")),M+I>y&&(I=y-M)),g.style.height=I+"px",H=e.clientX-X,k.absolute||(E=L.width(),b=parseInt(f.css("left")),b+H>E&&(H=E-b)),g.style.width=H+"px"},A=function(){S();var e=w;L.unbind("mousemove",j),C.removeClass("__make-note--moving").unbind("mouseup mouseleave",A),e.editing||(0>=$?(e.x=void 0,h.style.left="0"):e.x=$,0>=W?(e.y=void 0,h.style.top="0"):e.y=W,v&&(e.width=v),r&&(e.height=r),d(e.id,e.export()))},D=function(){var e=cwmMakeNote.get_node(g);L.unbind("mousemove",z),C.unbind("mouseup mouseleave",D),e.editing||(0>=H?(e.width=void 0,h.style.left="0"):e.width=H,0>=I?(e.height=void 0,h.style.height="0"):e.height=I,d(e.id,e.export()))};e(document).delegate(".__make-note--note","focusin",function(){e(this).addClass("__make-note--focused")}).delegate(".__make-note--note","focusout",function(){e(this).removeClass("__make-note--focused")}).delegate('[data-type="mover"]',"mousedown",function(e){1===event.which&&(w=cwmMakeNote.get_node(this),p=w.$el,h=p[0],T=e.clientX-h.offsetLeft,x=e.clientY-h.offsetTop,r=void 0,L.bind("mousemove",j),C.addClass("__make-note--moving").bind("mouseup mouseleave",A))}).delegate('[data-type="resize"]',"mousedown",function(e){1===event.which&&(k=cwmMakeNote.get_node(this),f=k.$el,g=f[0],X=e.clientX-f.outerWidth(!0),Y=e.clientY-f.outerHeight(!0),L.bind("mousemove",z),C.bind("mouseup mouseleave",D))}).delegate('[data-type="to-list"]',"click",function(){cwmMakeNote.get_node(this).toList(),cwmMakeNote.get_node(this).$el.remove()})}}();