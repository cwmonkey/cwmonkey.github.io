window.cwmPlaceImage=window.cwmPlaceImage||{},window.cwmPlaceImage.load=function(e,a){"use strict";var t,i,l,p,n,c,o,m,g,s=[{name:"Animals",places:[{name:"Place Bear",site:"placebear.com",template:"http://placebear.com/{type}/{width}/{height}",options:{type:["None",{text:"grayscale",value:"g"}]}},{name:"Place Kitten",site:"placekitten.com",template:"http://placekitten.com/{type}/{width}/{height}",options:{type:["None",{text:"grayscale",value:"g"}]}}]},{name:"Famous",places:[{name:"Place Cage",site:"placecage.com",template:"http://placecage.com/{type}/{width}/{height}",options:{type:["None",{text:"grayscale",value:"g"},{text:"CRAZY",value:"c"}]}},{name:"Place Cosby",site:"placecosby.com",template:"http://placecosby.com/{width}/{height}"}]},{name:"Food",places:[{name:"Bacon Mockup",site:"baconmockup.com",template:"http://baconmockup.com/{width}/{height}"},{name:"Lorem Pizza",site:"lorempizza.com",template:"http://lorempizza.com/{width}/{height}"}]},{name:"Other",places:[{name:"Lorem Pixel",site:"lorempixel.com",template:"http://lorempixel.com/{type}/{width}/{height}/{category}/{text}",options:{type:["None",{text:"grayscale",value:"g"}],category:["None","abstract","animals","business","cats","city","food","nightlife","fashion","people","nature","sports","technics","transport"]}},{name:"P-Hold",site:"p-hold.com/",template:"http://p-hold.com/{search}/{width}/{height}/{grey_blur}",options:{grey_blur:["None","grey","blur"]}}]},{name:"Text",places:[{name:"Dummy Image",site:"dummyimage.com",template:"http://dummyimage.com/{width}x{height}/{background}/{foreground}"},{name:"FPO IMG",site:"fpoimg.com",template:"http://fpoimg.com/{width}x{height}?text={text}"},{name:"Place Hold It",site:"placehold.it",template:"http://placehold.it/{width}x{height}"}]}],d={width:{type:"number","default":100},height:{type:"number","default":100},text:{type:"text","default":null},protocol:{type:"select","default":"https"},extension:{type:"select","default":"png"},background:{type:"text","default":null},foreground:{type:"text","default":null},type:{type:"select","default":null},category:{type:"select","default":null},search:{type:"text","default":null},grey_blur:{type:"select","default":null}},r={},u='<menu id="place-image-menu">		<form>			<fieldset class="place-image-set">				<legend id="place-image-config-head" class="place-image-head">Configuration</legend>				<div id="place-image-config">				</div>			</fieldset>			<fieldset class="place-image-set">				<legend id="place-image-options-head" class="place-image-head">Extra Options</legend>				<div id="place-image-options">				</div>			</fieldset>			<fieldset id="place-image-wh" class="place-image-set">				<legend class="place-image-head">Size</legend>				<label for="place-image-input-width" class="place-image-input">Width: <input type="number" value="100" id="place-image-input-width"></label>				<label for="place-image-input-height" class="place-image-input">Height: <input type="number" value="100" id="place-image-input-height"></label>			</fieldset>			<label id="place-image-result-label" for="place-image-result">				Image: <input type="text" id="place-image-result">				<button id="place-image-reload" title="Next Placeholder">&gt;</button>			</label>			<label id="place-image-buttons-label"><button id="place-image-update">&lt;- Update</button> <button id="place-image-close">Close</button></label>			<label id="place-image-img"></label>		</form>	</menu>',h='<link rel="stylesheet" id="place-image-css"/>',f=function(){m=a("body"),g=a('input[type="text"]:focus, textarea:focus'),t=a(u).attr({tabIndex:"-1"}).hide().appendTo("body").focus(),setTimeout(function(){t.show()},0),l=t.find("#place-image-result"),p=t.find("#place-image-update"),n=t.find("#place-image-config"),c=t.find("#place-image-options"),o=t.find("#place-image-img"),g.length||p.hide(),i=a(h).appendTo("head"),i.attr({href:e.cwmBookmarkletUrl+"/place-image.css?"+(new Date).getTime()});for(var f in d){var v=t.find("#place-image-input-"+f);if(v.length)v.data({option_name:f});else{var y=a("<label/>").attr({"for":"place-image-input-"+f,id:"place-image-input-"+f+"-label"}).addClass("place-image-input-label").html(f+": ");switch(r[f]=d[f].default||null,d[f].value=a.jStorage.get("place-image-"+f)||d[f].default,d[f].type){case"select":v=a("<select/>").attr("id","place-image-input-"+f);break;default:v=a('<input type="'+d[f].type+'"/>').attr("id","place-image-input-"+f)}v.val(d[f].value).data({option_name:f}),y.append(v).appendTo(c)}}for(var b=0,x=0;x<s.length;x++)for(var w=s[x].places,k=a("<fieldset/>").addClass("place-image-section").appendTo(n),T=a("<legend/>").appendTo(k),C=a("<label/>").html(" "+s[x].name).appendTo(T),f=(a('<input type="checkbox"/>').prependTo(C),0);f<w.length;f++){var P=w[f],y=a("<label/>").html(" "+P.name+" ").appendTo(k),v=a('<input type="checkbox"/>').addClass("place-image-site").attr({value:f}).data({site:P.site,i:b}).prependTo(y),z=(a('<a href="#"/>').attr({href:"http://"+P.site,target:"_blank"}).html("^").appendTo(y),a.jStorage.get("place-image-"+P.site));(null===z||z===!0)&&v.prop({checked:!0}),b++}var I,N,_,q,D=function(){a(".place-image-input-label").addClass("place-image-hide"),_=[];for(var e=n.find(".place-image-site:checked"),t=[],i=0;i<s.length;i++)for(var l=0;l<s[i].places.length;l++)t.push(s[i].places[l]);e.length||(e=n.find(".place-image-site").eq(1));for(var i=0;i<e.length;i++){var p=e.eq(i);_.push(t[p.data("i")])}var c={},o=/{([a-z\-_]+)}/g;for(var i in _)for(var m,g=_[i];m=o.exec(_[i].template);){var r=m[1];a("#place-image-input-"+r+"-label").removeClass("place-image-hide");var u=d[r];if("undefined"!=typeof g.options&&"undefined"!=g.options[r]){var h=g.options[r];if("select"===u.type){var f=a("#place-image-input-"+r);for(var v in h){var y=h[v],b=y.value||y,x=f.find("#place-image-input-"+r+"-"+b),w=y.text||y;x.length||(x=a("<option/>").attr({value:b,id:"place-image-input-"+r+"-"+b}).html(w).appendTo(f),u.value==b&&x.prop("selected",!0))}}c[m[1]]=m[1]}}},S=function(e){_=[];for(var t=n.find(".place-image-site:checked"),i=[],p=0;p<s.length;p++)for(var c=0;c<s[p].places.length;c++)i.push(s[p].places[c]);t.length||(t=n.find(".place-image-site").eq(1));for(var p=0;p<t.length;p++){var m=t.eq(p);_.push(i[m.data("i")])}"undefined"!=typeof e?(e++,e>=_.length&&(e=0),N=e):N=Math.floor(Math.random()*_.length);var g,r=_[N],u=r.template,h=u;for(var p in d){var f=a("#place-image-input-"+p),v=f.val();if(r.options&&r.options[p]){var y=!1;for(var b in r.options[p])if(v===(r.options[p][b].value||r.options[p][b])){y=!0;break}y||(v=null)}null!==v&&"None"!==v&&""!==v?(g=new RegExp("\\{"+p+"\\}"),h=h.replace(g,v)):(g=new RegExp("(\\.|\\/|(\\?[a-z]+=)|x)?\\{"+p+"\\}\\:?"),h=h.replace(g,""),g=new RegExp("\\{"+p+"\\}"),h=h.replace(g,""))}l.val(h);var x=a("<img/>").attr({src:h});clearTimeout(I),I=setTimeout(function(){o.empty().append(x)},100)},j=function(){clearTimeout(q),q=setTimeout(S,100)},E=function(){for(var e=t.find(".place-image-section"),a=0;a<e.length;a++){var i=e.eq(a),l=i.find("legend input"),p=i.find(".place-image-site:not(:checked)"),n=i.find(".place-image-site:checked");l.prop(p.length&&n.length?{checked:!1,indeterminate:!0}:p.length?{indeterminate:!1,checked:!1}:{indeterminate:!1,checked:!0})}};t.delegate(".place-image-section legend input","click",function(){var e=a(this);setTimeout(function(){var a=e.closest(".place-image-section");a.find(".place-image-site").prop({checked:e.is(":checked")}).change()},100)}).delegate("#place-image-wh input, #place-image-options input, #place-image-options select","keypress change",function(){var e=a(this);setTimeout(function(){var t=e.data("option_name");a.jStorage.set("place-image-"+t,e.val()),j()},0)}).delegate("#place-image-update","click",function(e){e.preventDefault(),g.val(l.val()).focus(),t.hide(),S()}).delegate("#place-image-reload","click",function(e){e.preventDefault(),S(N)}).delegate("#place-image-close","click",function(e){e.preventDefault(),t.hide(),S()}).delegate("#place-image-result","focus click",function(){var e=a(this);setTimeout(function(){e.select()},0)}).delegate("#place-image-config-head","click",function(){t.is(".place-image-config-open")?t.removeClass("place-image-config-open"):t.addClass("place-image-config-open")}).delegate("#place-image-options-head","click",function(){t.is(".place-image-options-open")?t.removeClass("place-image-options-open"):t.addClass("place-image-options-open")}).delegate("#place-image-config .place-image-site","change",function(){var e=a(this);setTimeout(function(){a.jStorage.set("place-image-"+e.data("site"),e.prop("checked")),E(),D(),j()},0)}),m.delegate("input:not(#place-image-menu input), textarea","focus",function(){g=a(this),p.show()}),D(),S(),E()},v=function(){t=a("#place-image-menu"),t.length?t.show():f()};e.cwmPlaceImage={main:v}};