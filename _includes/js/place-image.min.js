window.cwmPlaceImage=window.cwmPlaceImage||{},window.cwmPlaceImage.load=function(e,t){"use strict";var a,i,l,p,n,c,o,m,g,s=[{name:"Animals",places:[{name:"Place Bear",site:"placebear.com",template:"http://placebear.com/{type}/{width}/{height}",options:{type:["None",{text:"grayscale",value:"g"}]}},{name:"Place Kitten",site:"placekitten.com",template:"http://placekitten.com/{type}/{width}/{height}",options:{type:["None",{text:"grayscale",value:"g"}]}}]},{name:"Famous",places:[{name:"Nice Nice jpg",site:"nicenicejpg.com",template:"http://nicenicejpg.com/{width}/{height}"},{name:"Place Cage",site:"placecage.com",template:"http://placecage.com/{type}/{width}/{height}",options:{type:["None",{text:"grayscale",value:"g"},{text:"CRAZY",value:"c"}]}},{name:"Place Cosby",site:"placecosby.com",template:"http://placecosby.com/{width}/{height}"},{name:"Place Sheen",site:"placesheen.com",template:"http://placesheen.com/{width}/{height}"}]},{name:"Food",places:[{name:"Bacon Mockup",site:"baconmockup.com",template:"http://baconmockup.com/{width}/{height}"},{name:"Lorem Pizza",site:"lorempizza.com",template:"http://lorempizza.com/{width}/{height}"}]},{name:"Other",places:[{name:"Lorem Pixel",site:"lorempixel.com",template:"http://lorempixel.com/{type}/{width}/{height}/{category}/{text}",options:{type:["None",{text:"grayscale",value:"g"}],category:["None","abstract","animals","business","cats","city","food","nightlife","fashion","people","nature","sports","technics","transport"]}},{name:"P-Hold",site:"p-hold.com/",template:"http://p-hold.com/{search}/{width}/{height}/{grey_blur}",options:{grey_blur:["None","grey","blur"]}}]},{name:"Text",places:[{name:"Dummy Image",site:"dummyimage.com",template:"http://dummyimage.com/{width}x{height}/{background}/{foreground}"},{name:"FPO IMG",site:"fpoimg.com",template:"http://fpoimg.com/{width}x{height}?text={text}"},{name:"Placehold.io",site:"placehold.io",template:"{protocol}://placehold.io/{width}/{height}.{extension}?text={text}",options:{protocol:["None","http","https"],extension:["gif","jpeg","jpg","png","webp"]}},{name:"Place Hold It",site:"placehold.it",template:"http://placehold.it/{width}x{height}"}]}],d={width:{type:"number","default":100},height:{type:"number","default":100},text:{type:"text","default":null},protocol:{type:"select","default":"https"},extension:{type:"select","default":"png"},background:{type:"text","default":null},foreground:{type:"text","default":null},type:{type:"select","default":null},category:{type:"select","default":null},search:{type:"text","default":null},grey_blur:{type:"select","default":null}},r={},h='<menu id="place-image-menu">		<form>			<fieldset class="place-image-set">				<legend id="place-image-config-head" class="place-image-head">Configuration</legend>				<div id="place-image-config">				</div>			</fieldset>			<fieldset class="place-image-set">				<legend id="place-image-options-head" class="place-image-head">Extra Options</legend>				<div id="place-image-options">				</div>			</fieldset>			<fieldset id="place-image-wh" class="place-image-set">				<legend class="place-image-head">Size</legend>				<label for="place-image-input-width" class="place-image-input">Width: <input type="number" value="100" id="place-image-input-width"></label>				<label for="place-image-input-height" class="place-image-input">Height: <input type="number" value="100" id="place-image-input-height"></label>			</fieldset>			<label id="place-image-result-label" for="place-image-result">				Image: <input type="text" id="place-image-result">				<button id="place-image-reload" title="Next Placeholder">&gt;</button>			</label>			<label id="place-image-buttons-label"><button id="place-image-update">&lt;- Update</button> <button id="place-image-close">Close</button></label>			<label id="place-image-img"></label>		</form>	</menu>',u='<link rel="stylesheet" id="place-image-css"/>',f=function(){m=t("body"),g=t('input[type="text"]:focus, textarea:focus'),a=t(h).attr({tabIndex:"-1"}).hide().appendTo("body").focus(),setTimeout(function(){a.show()},0),l=a.find("#place-image-result"),p=a.find("#place-image-update"),n=a.find("#place-image-config"),c=a.find("#place-image-options"),o=a.find("#place-image-img"),g.length||p.hide(),i=t(u).appendTo("head"),i.attr({href:e.cwmBookmarkletUrl+"/place-image.css?"+(new Date).getTime()});for(var f in d){var v=a.find("#place-image-input-"+f);if(v.length)v.data({option_name:f});else{var y=t("<label/>").attr({"for":"place-image-input-"+f,id:"place-image-input-"+f+"-label"}).addClass("place-image-input-label").html(f+": ");switch(r[f]=d[f].default||null,d[f].value=t.jStorage.get("place-image-"+f)||d[f].default,d[f].type){case"select":v=t("<select/>").attr("id","place-image-input-"+f);break;default:v=t('<input type="'+d[f].type+'"/>').attr("id","place-image-input-"+f)}v.val(d[f].value).data({option_name:f}),y.append(v).appendTo(c)}}for(var b=0,x=0;x<s.length;x++)for(var w=s[x].places,k=t("<fieldset/>").addClass("place-image-section").appendTo(n),T=t("<legend/>").appendTo(k),P=t("<label/>").html(" "+s[x].name).appendTo(T),f=(t('<input type="checkbox"/>').prependTo(P),0);f<w.length;f++){var C=w[f],y=t("<label/>").html(" "+C.name+" ").appendTo(k),v=t('<input type="checkbox"/>').addClass("place-image-site").attr({value:f}).data({site:C.site,i:b}).prependTo(y),N=(t('<a href="#"/>').attr({href:"http://"+C.site,target:"_blank"}).html("^").appendTo(y),t.jStorage.get("place-image-"+C.site));(null===N||N===!0)&&v.prop({checked:!0}),b++}var j,z,I,_,S=function(){t(".place-image-input-label").addClass("place-image-hide"),I=[];for(var e=n.find(".place-image-site:checked"),a=[],i=0;i<s.length;i++)for(var l=0;l<s[i].places.length;l++)a.push(s[i].places[l]);e.length||(e=n.find(".place-image-site").eq(1));for(var i=0;i<e.length;i++){var p=e.eq(i);I.push(a[p.data("i")])}var c={},o=/{([a-z\-_]+)}/g;for(var i in I)for(var m,g=I[i];m=o.exec(I[i].template);){var r=m[1];t("#place-image-input-"+r+"-label").removeClass("place-image-hide");var h=d[r];if("undefined"!=typeof g.options&&"undefined"!=g.options[r]){var u=g.options[r];if("select"===h.type){var f=t("#place-image-input-"+r);for(var v in u){var y=u[v],b=y.value||y,x=f.find("#place-image-input-"+r+"-"+b),w=y.text||y;x.length||(x=t("<option/>").attr({value:b,id:"place-image-input-"+r+"-"+b}).html(w).appendTo(f),h.value==b&&x.prop("selected",!0))}}c[m[1]]=m[1]}}},q=function(e){I=[];for(var a=n.find(".place-image-site:checked"),i=[],p=0;p<s.length;p++)for(var c=0;c<s[p].places.length;c++)i.push(s[p].places[c]);a.length||(a=n.find(".place-image-site").eq(1));for(var p=0;p<a.length;p++){var m=a.eq(p);I.push(i[m.data("i")])}"undefined"!=typeof e?(e++,e>=I.length&&(e=0),z=e):z=Math.floor(Math.random()*I.length);var g,r=I[z],h=r.template,u=h;for(var p in d){var f=t("#place-image-input-"+p),v=f.val();if(r.options&&r.options[p]){var y=!1;for(var b in r.options[p])if(v===(r.options[p][b].value||r.options[p][b])){y=!0;break}y||(v=null)}null!==v&&"None"!==v&&""!==v?(g=new RegExp("\\{"+p+"\\}"),u=u.replace(g,v)):(g=new RegExp("(\\.|\\/|(\\?[a-z]+=)|x)?\\{"+p+"\\}\\:?"),u=u.replace(g,""),g=new RegExp("\\{"+p+"\\}"),u=u.replace(g,""))}l.val(u);var x=t("<img/>").attr({src:u});clearTimeout(j),j=setTimeout(function(){o.empty().append(x)},100)},D=function(){clearTimeout(_),_=setTimeout(q,100)},E=function(){for(var e=a.find(".place-image-section"),t=0;t<e.length;t++){var i=e.eq(t),l=i.find("legend input"),p=i.find(".place-image-site:not(:checked)"),n=i.find(".place-image-site:checked");l.prop(p.length&&n.length?{checked:!1,indeterminate:!0}:p.length?{indeterminate:!1,checked:!1}:{indeterminate:!1,checked:!0})}};a.delegate(".place-image-section legend input","click",function(){var e=t(this);setTimeout(function(){var t=e.closest(".place-image-section");t.find(".place-image-site").prop({checked:e.is(":checked")}).change()},100)}).delegate("#place-image-wh input, #place-image-options input, #place-image-options select","keypress change",function(){var e=t(this);setTimeout(function(){var a=e.data("option_name");t.jStorage.set("place-image-"+a,e.val()),D()},0)}).delegate("#place-image-update","click",function(e){e.preventDefault(),g.val(l.val()).focus(),a.hide(),q()}).delegate("#place-image-reload","click",function(e){e.preventDefault(),q(z)}).delegate("#place-image-close","click",function(e){e.preventDefault(),a.hide(),q()}).delegate("#place-image-result","focus click",function(){var e=t(this);setTimeout(function(){e.select()},0)}).delegate("#place-image-config-head","click",function(){a.is(".place-image-config-open")?a.removeClass("place-image-config-open"):a.addClass("place-image-config-open")}).delegate("#place-image-options-head","click",function(){a.is(".place-image-options-open")?a.removeClass("place-image-options-open"):a.addClass("place-image-options-open")}).delegate("#place-image-config .place-image-site","change",function(){var e=t(this);setTimeout(function(){t.jStorage.set("place-image-"+e.data("site"),e.prop("checked")),E(),S(),D()},0)}),m.delegate("input:not(#place-image-menu input), textarea","focus",function(){g=t(this),p.show()}),S(),q(),E()},v=function(){a=t("#place-image-menu"),a.length?a.show():f()};e.cwmPlaceImage={main:v}};