window.cwmScreengrab=window.cwmScreengrab||{};window.cwmScreengrab.load=function(window,$,undefined){'use strict';var tpl='<menu id="screengrab-menu">\
  <form>\
   <fieldset class="screengrab-set">\
    <legend id="screengrab-config-head" class="screengrab-head">Configuration</legend>\
    <img id="screengrab-screen-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">\
    <div>\
     <label for="screengrab-screen">\
      <input type="text" id="screengrab-screen" name="screengrab-screen">\
     </label>\
    </div>\
    <img id="screengrab-icon-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">\
    <div>\
     <label for="screengrab-icon">\
      <input type="text" id="screengrab-icon" name="screengrab-icon">\
     </label>\
    </div>\
   </fieldset>\
  </form>\
 </menu>';var $menu=$(tpl);var $screen=$menu.find('#screengrab-screen');var $icon=$menu.find('#screengrab-icon');var $screen_img=$menu.find('#screengrab-screen-img');var $icon_img=$menu.find('#screengrab-icon-img');var css='<link rel="stylesheet" id="screengrab-css"/>';var $css;var setup=function(){$css=$(css).appendTo('head');$css.attr({href:window.cwmBookmarkletUrl+'/screengrab.css?'+new Date().getTime()});$menu.hide().appendTo('body');};var main=function(){html2canvas(document.body,{onrendered:function(canvas){var img=new Image();var ctx=canvas.getContext('2d');var canvasCopy=document.createElement('canvas');var copyContext=canvasCopy.getContext('2d');var ratio=1;var maxWidth=138;var maxHeight=83;var src;img.onload=function(){if(img.width>maxWidth){ratio=maxWidth/img.width;}else if(img.height>maxHeight){ratio=maxHeight/img.height;}
canvasCopy.width=img.width;canvasCopy.height=img.height;copyContext.drawImage(img,0,0);canvas.width=maxWidth;canvas.height=maxHeight;ctx.drawImage(canvasCopy,0,0,canvasCopy.width,canvasCopy.height-300,0,0,maxWidth,maxHeight);src=canvas.toDataURL('image/gif');$screen.val(src);$screen_img.attr('src',src);$menu.show();}
img.src=canvas.toDataURL('image/gif');}});var img=new Image();var canvasCopy=document.createElement('canvas');var copyContext=canvasCopy.getContext('2d');var src;img.onload=function(){canvasCopy.width=16;canvasCopy.height=16;copyContext.drawImage(img,0,0,16,16);src=canvasCopy.toDataURL('image/gif');$icon.val(src);$icon_img.attr('src',src);}
img.onerror=function(){var favicon="";var links=document.getElementsByTagName('link');for(var i=0;i<links.length;i++){var link=links[i];var rel='"'+link.getAttribute("rel")+'"';var regexp=/(\"icon )|( icon\")|(\"icon\")|( icon )/i;if(rel.search(regexp)!=-1){favicon=link.getAttribute("href");}}
img.onerror=null;img.src=favicon;}
img.src='/favicon.ico';};window.cwmScreengrab={main:main};setup();};