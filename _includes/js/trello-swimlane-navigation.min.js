!function(){var e,a,l,n,t,s,i,r=!1,m=$("body"),d='<link rel="stylesheet" id="trello-swimlane-navigation-css"/>';$css=$(d).appendTo("head"),$css.attr({href:window.cwmBookmarkletUrl+"/trello-swimlane-navigation.css?2"});var o=function(){return document.location.pathname.split("/")[2]};m.delegate(".lane-menu-toggle","click",function(e){e.preventDefault(),n.is(".lane-menu-hide")?(n.removeClass("lane-menu-hide"),localStorage.removeItem("lane-menu-hide")):(n.addClass("lane-menu-hide"),localStorage.setItem("lane-menu-hide",1))});var c=function(e,a){var l=new $.Deferred,n=function(){$(e).length?l.resolve():setTimeout(n,a||100)};return setTimeout(n,a||100),l},u=function(){return"undefined"==typeof jQuery?void setTimeout(u,500):void function(m){m(function(){if(e=m("#board"),l=m(".board-canvas"),n=m("#content"),i=localStorage.getItem("lane-menu-hide"),i&&n.addClass("lane-menu-hide"),a=m(".board-wrapper"),m(".js-show-extra-members").trigger("click"),x=e.find(".list"),t=e.find(".list-card"),s=m("#trello-swimlane-navigation-css"),!(s.length&&("loaded"==s.css("content")||'"loaded"'==s.css("content"))&&n.length&&a.length&&l.length&&e.length&&x.length&&t.length))return void setTimeout(u,500);var d=m("<div/>").addClass("lane-menu u-fancy-scrollbar"),f=m("<menu/>").addClass("lane-menu-nav").appendTo(d),v=m("<h2/>").addClass("lane-menu-headline").html("Navigation").appendTo(f),h=function(){f.addClass("lane-menu-hidden"),localStorage.setItem("hide_lane_nav:"+o(),1)},b=(m("<button/>").html("(Hide)").addClass("lane-menu-hide").bind("click",h).appendTo(v),m("<button/>").html("(Show)").addClass("lane-menu-show").bind("click",function(){f.removeClass("lane-menu-hidden"),localStorage.removeItem("hide_lane_nav:"+o())}).appendTo(v),localStorage.getItem("hide_lane_nav:"+o()));b&&h();var p=localStorage.getItem("order:"+o()),g=null;if(p&&(p=JSON.parse(p),g={}),F=m(".board-widget-members"),x.each(function(){var e=m(this),a=e.find(".list-header-name").text();if(a){var l=a.split(/[ \-]/),n=l[0],t=F.find('img[alt^="'+a+'"], img[alt^="'+a.toLowerCase()+'"], .member-initials[title^="'+a+'"], .member-initials[title^="'+a.toLowerCase()+'"]');t.length||(t=F.find('img[alt^="'+n+'"], img[alt^="'+n.toLowerCase()+'"], .member-initials[title^="'+n+'"], .member-initials[title^="'+n.toLowerCase()+'"]'));var s=m("<button/>").addClass("lane-menu-nav-item").html('<span class="lane-menu-name">'+a+"</span>");t.length&&s.prepend(t.eq(0).clone()),s.data("target",e),p?g[a]=s:f.append(s)}}),p){for(var C=0;C<p.length;C++){var w=g[p[C]];f.append(w),g[p[C]]=""}for(var S in g)g.hasOwnProperty(S)&&""!=g[S]&&f.append(g[S])}var T=m("<div/>").addClass("lane-menu-wrapper");if(T.append('<a href="#" class="lane-menu-toggle dark-hover js-hide-sidebar" title="Show/hide swimlane navbar."><span class="icon-sm icon-forward lane-menu-open"></span><span class="icon-sm icon-forward lane-menu-closed"></span></a>').append(d),n.prepend(T),f.delegate(".lane-menu-nav-item","click",function(a){a.preventDefault();var l=m(this),n=l.data("target"),t=n.position().left+e.scrollLeft();e.animate({scrollLeft:t},"fast"),localStorage.setItem("scrollToLeft",t)}).sortable({items:"> .lane-menu-nav-item",cancel:"",stop:function(){var e=d.find(".lane-menu-nav-item"),a=[];e.each(function(){var e=m(this);a.push(e.find(".lane-menu-name").text())}),localStorage.setItem("order:"+o(),JSON.stringify(a))}}).disableSelection(),!r){r=!0;var I=!1;e.bind("scroll",function(){I||(I=!0,setTimeout(function(){localStorage.setItem("scrollToLeft",e.scrollLeft()),I=!1},100))});var k=localStorage.getItem("scrollToLeft");k&&e.animate({scrollLeft:k},"fast")}var _=function(){var a=!1;m(".list-card").removeClass("lane-menu-member-filters-show");for(C in N)a=!0,m('.list-card:has([title$="('+C+')"])').addClass("lane-menu-member-filters-show");a?e.addClass("lane-menu-member-filters-filtered"):e.removeClass("lane-menu-member-filters-filtered"),localStorage.setItem("filter_members:"+o(),JSON.stringify(N));var l=!1;m(".lane").removeClass("lane-menu-member-filters-hide");for(C in j){l=!0;break}l?e.addClass("lane-menu-lane-filters-filtered"):e.removeClass("lane-menu-lane-filters-filtered"),localStorage.setItem("filter_lanes:"+o(),JSON.stringify(j));var n=!1;m(".list-card").removeClass("lane-menu-label-filters-show");for(C in D)n=!0,m('.list-card:has([title="'+C+'"])').addClass("lane-menu-label-filters-show");n?e.addClass("lane-menu-label-filters-filtered"):e.removeClass("lane-menu-label-filters-filtered"),localStorage.setItem("filter_labels:"+o(),JSON.stringify(D))},F=m(".board-widget-members .member :first-child"),$=m("<menu/>").addClass("lane-menu-member-filters").appendTo(d),L=m("<h2>").addClass("lane-menu-headline").html("Member Filters").appendTo($),N=(m("<button>(Clear)</button>").bind("click",function(){N={},m(".lane-menu-member-filters-member").removeClass("lane-menu-member-filters-active"),m(".list:not(.mod-add)").removeClass("lane-menu-member-filters-hide"),_()}).appendTo(L),localStorage.getItem("filter_members:"+o()));N=N?JSON.parse(N):{},F.each(function(){var e=this.title.match(/\(([^\)]+)\)$/)[1],a=m("<div/>").addClass("lane-menu-member-filters-member").append(m(this).clone().attr("class","")).data("name",e);N[e]&&a.addClass("lane-menu-member-filters-active"),$.append(a)}),$.delegate(".lane-menu-member-filters-member","click",function(){var e=m(this),a=e.data("name");e.is(".lane-menu-member-filters-active")?(e.removeClass("lane-menu-member-filters-active"),delete N[a]):(e.addClass("lane-menu-member-filters-active"),N[a]=!0),_()});var x=m(".list:not(.mod-add)"),y=m("<menu/>").addClass("lane-menu-lane-filters").appendTo(d),O=m("<h2>").addClass("lane-menu-headline").html("Lane Filters").appendTo(y),j=(m("<button>(Clear)</button>").bind("click",function(){j={},m(".lane-menu-lane-filters-lane").removeClass("lane-menu-lane-filters-active"),_()}).appendTo(O),localStorage.getItem("filter_lanes:"+o()));j=j?JSON.parse(j):{},x.each(function(){var e=m(this),a="lane"+(new Date).getTime();e.data("laneid",a);var l=e.find(".list-header-name").text(),n=m("<div/>").addClass("lane-menu-lane-filters-lane").html(l).data("lane",e);j[l]&&(n.addClass("lane-menu-lane-filters-active"),e.addClass("lane-menu-member-filters-hide")),y.append(n)}),y.delegate(".lane-menu-lane-filters-lane","click",function(){var e=m(this),a=e.data("lane"),l=a.find(".list-header-name").text();e.is(".lane-menu-lane-filters-active")?(a.removeClass("lane-menu-member-filters-hide"),e.removeClass("lane-menu-lane-filters-active"),delete j[l]):(a.addClass("lane-menu-member-filters-hide"),e.addClass("lane-menu-lane-filters-active"),j[l]=!0),_()}),$label_filters=m("<menu/>").addClass("lane-menu-label-filters").insertBefore(y);var J=m("<h2>").addClass("lane-menu-headline").html("Label Filters").appendTo($label_filters),D=(m("<button>(Clear)</button>").bind("click",function(){D={},m(".lane-menu-label-filters-label").removeClass("lane-menu-label-filters-active"),_()}).appendTo(J),localStorage.getItem("filter_labels:"+o()));D=D?JSON.parse(D):{};var A=function(){$label_filters.delegate(".lane-menu-label-filters-label","click",function(){var e=m(this),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");e.is(".lane-menu-label-filters-active")?(e.removeClass("lane-menu-label-filters-active"),delete D[a]):(e.addClass("lane-menu-label-filters-active"),D[a]=!0),_()})};m.when(c(".edit-labels-pop-over .card-label",1e3)).then(function(){var e=m(".js-labels-list .card-label");e.each(function(){var e=m(this).clone().addClass("lane-menu-label-filters-label"),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");D[a]&&e.addClass("lane-menu-label-filters-active"),e.find("*").detach(),$label_filters.append(e)}),m(".js-pop-widget-view").click(),A(),E()}),m(".js-open-labels").click();var E=function(){var a;e.bind("DOMNodeInserted DOMNodeRemoved",function(e){(e.target.className.match(/js-member-on-card-menu/)||e.target.className.match(/list-card/))&&(clearTimeout(a),a=setTimeout(_,1e3))});var l=T.width();n.css({"padding-left":l+10}),T.css({left:-1*(l+10)});var t=setInterval(function(){T.parent().length||(T.remove(),clearInterval(t),u())},500);_()}})}(window.jQuery)};u()}();