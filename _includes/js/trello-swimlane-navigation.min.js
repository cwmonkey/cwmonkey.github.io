!function(){var e,a,l,t,n,s,i,r=!1,m=$("body"),o='<link rel="stylesheet" id="trello-swimlane-navigation-css"/>';$css=$(o).appendTo("head"),$css.attr({href:window.cwmBookmarkletUrl+"/trello-swimlane-navigation.css?2"});var d=function(){return document.location.pathname.split("/")[2]};m.delegate(".lane-menu-toggle","click",function(e){e.preventDefault(),t.is(".lane-menu-hide")?(t.removeClass("lane-menu-hide"),localStorage.removeItem("lane-menu-hide")):(t.addClass("lane-menu-hide"),localStorage.setItem("lane-menu-hide",1))});var c=function(){return"undefined"==typeof jQuery?void setTimeout(c,500):void function(m){m(function(){if(e=m("#board"),l=m(".board-canvas"),t=m("#content"),i=localStorage.getItem("lane-menu-hide"),i&&t.addClass("lane-menu-hide"),a=m(".board-wrapper"),m(".js-show-extra-members").trigger("click"),N=e.find(".list"),n=e.find(".list-card"),s=m("#trello-swimlane-navigation-css"),!(s.length&&("loaded"==s.css("content")||'"loaded"'==s.css("content"))&&t.length&&a.length&&l.length&&e.length&&N.length&&n.length))return void setTimeout(c,500);var o=m("<div/>").addClass("lane-menu u-fancy-scrollbar"),f=m("<menu/>").addClass("lane-menu-nav").appendTo(o),u=localStorage.getItem("order:"+d()),v=null;if(u&&(u=JSON.parse(u),v={}),I=m(".board-widget-members"),N.each(function(){var e=m(this),a=e.find(".list-header-name").text();if(a){var l=a.split(/[ \-]/),t=l[0],n=I.find('img[alt^="'+a+'"], img[alt^="'+a.toLowerCase()+'"], .member-initials[title^="'+a+'"], .member-initials[title^="'+a.toLowerCase()+'"]');n.length||(n=I.find('img[alt^="'+t+'"], img[alt^="'+t.toLowerCase()+'"], .member-initials[title^="'+t+'"], .member-initials[title^="'+t.toLowerCase()+'"]'));var s=m("<button/>").html('<span class="lane-menu-name">'+a+"</span>");n.length&&s.prepend(n.eq(0).clone()),s.data("target",e),u?v[a]=s:f.append(s)}}),u){for(var b=0;b<u.length;b++){var h=v[u[b]];f.append(h),v[u[b]]=""}for(var p in v)v.hasOwnProperty(p)&&""!=v[p]&&f.append(v[p])}var g=m("<div/>").addClass("lane-menu-wrapper");if(g.append('<a href="#" class="lane-menu-toggle dark-hover js-hide-sidebar" title="Show/hide swimlane navbar."><span class="icon-sm icon-forward lane-menu-open"></span><span class="icon-sm icon-forward lane-menu-closed"></span></a>').append(o),t.prepend(g),f.delegate("button","click",function(a){a.preventDefault();var l=m(this),t=l.data("target"),n=t.position().left+e.scrollLeft();e.animate({scrollLeft:n},"fast"),localStorage.setItem("scrollToLeft",n)}).sortable({items:"> button",cancel:"",stop:function(){var e=o.find("button"),a=[];e.each(function(){var e=m(this);a.push(e.find(".lane-menu-name").text())}),localStorage.setItem("order:"+d(),JSON.stringify(a))}}).disableSelection(),!r){r=!0;var C=!1;e.bind("scroll",function(){C||(C=!0,setTimeout(function(){localStorage.setItem("scrollToLeft",e.scrollLeft()),C=!1},100))});var w=localStorage.getItem("scrollToLeft");w&&e.animate({scrollLeft:w},"fast")}var S=function(){var a=!1;m(".list-card").removeClass("lane-menu-member-filters-show");for(b in F)a=!0,m('.list-card:has([title$="('+b+')"])').addClass("lane-menu-member-filters-show");a?e.addClass("lane-menu-member-filters-filtered"):e.removeClass("lane-menu-member-filters-filtered"),localStorage.setItem("filter_members:"+d(),JSON.stringify(F));var l=!1;m(".lane").removeClass("lane-menu-member-filters-hide");for(b in x){l=!0;break}l?e.addClass("lane-menu-lane-filters-filtered"):e.removeClass("lane-menu-lane-filters-filtered"),localStorage.setItem("filter_lanes:"+d(),JSON.stringify(x));var t=!1;m(".list-card").removeClass("lane-menu-label-filters-show");for(b in y)t=!0,m('.list-card:has([title="'+b+'"])').addClass("lane-menu-label-filters-show");t?e.addClass("lane-menu-label-filters-filtered"):e.removeClass("lane-menu-label-filters-filtered"),localStorage.setItem("filter_labels:"+d(),JSON.stringify(y))},T=m("<h2>").addClass("lane-menu-headline").html("Filters").appendTo(o),I=m(".board-widget-members .member :first-child"),k=m("<menu/>").addClass("lane-menu-member-filters").appendTo(o),F=(m("<button>(Clear Filters)</button>").bind("click",function(){F={},x={},m(".lane-menu-member-filters-member").removeClass("lane-menu-member-filters-active"),m(".lane-menu-lane-filters-lane").removeClass("lane-menu-lane-filters-active"),m(".list:not(.mod-add)").removeClass("lane-menu-member-filters-hide"),S()}).appendTo(T),localStorage.getItem("filter_members:"+d()));F=F?JSON.parse(F):{},I.each(function(){var e=this.title.match(/\(([^\)]+)\)$/)[1],a=m("<div/>").addClass("lane-menu-member-filters-member").append(m(this).clone().attr("class","")).data("name",e);F[e]&&a.addClass("lane-menu-member-filters-active"),k.append(a)}),k.delegate(".lane-menu-member-filters-member","click",function(){var e=m(this),a=e.data("name");e.is(".lane-menu-member-filters-active")?(e.removeClass("lane-menu-member-filters-active"),delete F[a]):(e.addClass("lane-menu-member-filters-active"),F[a]=!0),S()});var N=m(".list:not(.mod-add)"),O=m("<menu/>").addClass("lane-menu-lane-filters").appendTo(o),x=localStorage.getItem("filter_lanes:"+d());x=x?JSON.parse(x):{},N.each(function(){var e=m(this),a="lane"+(new Date).getTime();e.data("laneid",a);var l=e.find(".list-header-name").text(),t=m("<div/>").addClass("lane-menu-lane-filters-lane").html(l).data("lane",e);x[l]&&(t.addClass("lane-menu-lane-filters-active"),e.addClass("lane-menu-member-filters-hide")),O.append(t)}),O.delegate(".lane-menu-lane-filters-lane","click",function(){var e=m(this),a=e.data("lane"),l=a.find(".list-header-name").text();e.is(".lane-menu-lane-filters-active")?(a.removeClass("lane-menu-member-filters-hide"),e.removeClass("lane-menu-lane-filters-active"),delete x[l]):(a.addClass("lane-menu-member-filters-hide"),e.addClass("lane-menu-lane-filters-active"),x[l]=!0),S()}),$label_filters=m("<menu/>").addClass("lane-menu-label-filters").appendTo(o);var y=localStorage.getItem("filter_labels:"+d());y=y?JSON.parse(y):{},m(".js-open-labels").click();var L,$=function(){var e=m(".js-labels-list .card-label");return e.length?(e.each(function(){var e=m(this).clone().addClass("lane-menu-label-filters-label"),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");y[a]&&e.addClass("lane-menu-label-filters-active"),e.find("*").detach(),$label_filters.append(e)}),m(".js-pop-widget-view").click(),j(),void _()):(clearTimeout(L),void(L=setTimeout($,100)))};m(".js-labels-list").bind("DOMNodeInserted",function(){clearTimeout(L),L=setTimeout($,100)});var j=function(){$label_filters.delegate(".lane-menu-label-filters-label","click",function(){var e=m(this),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");e.is(".lane-menu-label-filters-active")?(e.removeClass("lane-menu-label-filters-active"),delete y[a]):(e.addClass("lane-menu-label-filters-active"),y[a]=!0),S()})},_=function(){var a;e.bind("DOMNodeInserted DOMNodeRemoved",function(e){(e.target.className.match(/js-member-on-card-menu/)||e.target.className.match(/list-card/))&&(clearTimeout(a),a=setTimeout(S,1e3))});var l=g.width();t.css({"padding-left":l+10}),g.css({left:-1*(l+10)});var n=setInterval(function(){g.parent().length||(g.remove(),clearInterval(n),c())},500);S()}})}(window.jQuery)};c()}();