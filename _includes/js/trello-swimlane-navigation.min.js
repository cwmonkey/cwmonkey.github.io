!function(){var e,a,l,t,n,s,i,r,o=!1,d='<link rel="stylesheet" id="trello-swimlane-navigation-css"/>';$css=$(d).appendTo("head"),$css.attr({href:window.cwmBookmarkletUrl+"/trello-swimlane-navigation.css?2"});var m=function(){return document.location.pathname.split("/")[2]},c=function(e,a){var l=new $.Deferred,t=function(){$(e).length?l.resolve():setTimeout(t,a||100)};return setTimeout(t,a||100),l},u=function(){return"undefined"==typeof jQuery?void setTimeout(u,500):void function(d){d(function(){if(d.fn.tooltip||(!function(e){var a,l=e("body"),t=e(window),n="tooltip",s="tooltip",i="tooltipShown",r=e("<span/>").addClass(s).attr("id",n).css({position:"absolute"}),o=e("<span/>").addClass(s+"-text").appendTo(r),d=e("<span/>").addClass(s+"-arrow").appendTo(r),m=function(){var s=e(this),m=s.data("title")||this.title;if(m){clearTimeout(a),o.html(m),s.data("title",m).attr({title:"","aria-describedby":n}),r.css({left:"",width:""});var c=s.offset(),u=s.outerWidth(),f=s.outerHeight();r.appendTo(l);var v=r.outerWidth();r.css("width",v);var h=c.left+u/2-v/2;if(0>h?(d.css("left",h),h=0):d.css("left",0),r.css({left:h,top:c.top+f}).addClass(i),h+r.outerWidth()>t.width()){var b=h+r.outerWidth()-t.width();r.css("left",h-b),d.css("left",b)}}},c=function(){var l=e(this);clearTimeout(a),a=setTimeout(function(){l.attr("aria-describedby",""),r.removeClass(i)},10)};e.fn.tooltip=function(){var a=this.selector,t=function(){var t=!1;l.bind("mousemove",function(l){if(t)return void(t=!1);var n=e(l.target).closest(a);n.length?m.call(n[0]):c()}).bind("mousedown mouseup",function(){t=!0,c()})};return l.length?t():e(function(){t()}),this}}(window.jQuery),d(".member-avatar, .member-initials, .lane-menu-member-filters-member [title]").tooltip()),i=d("body"),e=d("#board"),l=d(".board-canvas"),t=d("#content"),r=localStorage.getItem("lane-menu-hide"),r&&t.addClass("lane-menu-hide"),a=d(".board-wrapper"),d(".js-show-extra-members").trigger("click"),x=e.find(".list"),n=e.find(".list-card"),s=d("#trello-swimlane-navigation-css"),!(s.length&&("loaded"==s.css("content")||'"loaded"'==s.css("content"))&&t.length&&a.length&&l.length&&e.length&&x.length&&n.length))return void setTimeout(u,500);var f=d("<div/>").addClass("lane-menu u-fancy-scrollbar"),v=d("<menu/>").addClass("lane-menu-nav").appendTo(f),h=d("<h2/>").addClass("lane-menu-headline").html("Navigation").appendTo(v),b=function(){v.addClass("lane-menu-hidden"),localStorage.setItem("hide_lane_nav:"+m(),1)},p=(d("<button/>").html("(Hide)").addClass("lane-menu-hide").bind("click",b).appendTo(h),d("<button/>").html("(Show)").addClass("lane-menu-show").bind("click",function(){v.removeClass("lane-menu-hidden"),localStorage.removeItem("hide_lane_nav:"+m())}).appendTo(h),localStorage.getItem("hide_lane_nav:"+m()));p&&b();var g=localStorage.getItem("order:"+m()),C=null;if(g&&(g=JSON.parse(g),C={}),F=d(".board-widget-members"),x.each(function(){var e=d(this),a=e.find(".list-header-name").text();if(a){var l=a.split(/[ \-]/),t=l[0],n=F.find('img[alt^="'+a+'"], img[alt^="'+a.toLowerCase()+'"], .member-initials[title^="'+a+'"], .member-initials[title^="'+a.toLowerCase()+'"]');n.length||(n=F.find('img[alt^="'+t+'"], img[alt^="'+t.toLowerCase()+'"], .member-initials[title^="'+t+'"], .member-initials[title^="'+t.toLowerCase()+'"]'));var s=d("<button/>").addClass("lane-menu-nav-item").html('<span class="lane-menu-name">'+a+"</span>");n.length&&s.prepend(n.eq(0).clone()),s.data("target",e),g?C[a]=s:v.append(s)}}),g){for(var w=0;w<g.length;w++){var T=C[g[w]];v.append(T),C[g[w]]=""}for(var S in C)C.hasOwnProperty(S)&&""!=C[S]&&v.append(C[S])}var I=d("<div/>").addClass("lane-menu-wrapper");I.append(f);d('<a href="#" class="lane-menu-toggle dark-hover js-hide-sidebar" title="Show/hide swimlane navbar."><span class="icon-sm icon-forward lane-menu-open"></span><span class="icon-sm icon-forward lane-menu-closed"></span></a>').bind("click",function(e){e.preventDefault(),t.is(".lane-menu-hide")?(t.removeClass("lane-menu-hide"),localStorage.removeItem("lane-menu-hide")):(t.addClass("lane-menu-hide"),localStorage.setItem("lane-menu-hide",1))}).prependTo(I);if(t.prepend(I),v.delegate(".lane-menu-nav-item","click",function(a){a.preventDefault();var l=d(this),t=l.data("target"),n=t.position().left+e.scrollLeft();e.animate({scrollLeft:n},"fast"),localStorage.setItem("scrollToLeft",n)}).sortable({items:"> .lane-menu-nav-item",cancel:"",stop:function(){var e=f.find(".lane-menu-nav-item"),a=[];e.each(function(){var e=d(this);a.push(e.find(".lane-menu-name").text())}),localStorage.setItem("order:"+m(),JSON.stringify(a))}}).disableSelection(),!o){o=!0;var k=!1;e.bind("scroll",function(){k||(k=!0,setTimeout(function(){localStorage.setItem("scrollToLeft",e.scrollLeft()),k=!1},100))});var _=localStorage.getItem("scrollToLeft");_&&e.animate({scrollLeft:_},"fast")}var y=function(){var a=!1;d(".list-card").removeClass("lane-menu-member-filters-show");for(w in $)a=!0,d('.list-card:has([title$="('+w+')"])').addClass("lane-menu-member-filters-show");a?e.addClass("lane-menu-member-filters-filtered"):e.removeClass("lane-menu-member-filters-filtered"),localStorage.setItem("filter_members:"+m(),JSON.stringify($));var l=!1;d(".lane").removeClass("lane-menu-member-filters-hide");for(w in J){l=!0;break}l?e.addClass("lane-menu-lane-filters-filtered"):e.removeClass("lane-menu-lane-filters-filtered"),localStorage.setItem("filter_lanes:"+m(),JSON.stringify(J));var t=!1;d(".list-card").removeClass("lane-menu-label-filters-show");for(w in A)t=!0,d('.list-card:has([title="'+w+'"])').addClass("lane-menu-label-filters-show");t?e.addClass("lane-menu-label-filters-filtered"):e.removeClass("lane-menu-label-filters-filtered"),localStorage.setItem("filter_labels:"+m(),JSON.stringify(A))},F=d(".board-widget-members .member :first-child"),L=d("<menu/>").addClass("lane-menu-member-filters").appendTo(f),N=d("<h2>").addClass("lane-menu-headline").html("Member Filters").appendTo(L),$=(d("<button>(Clear)</button>").bind("click",function(){$={},d(".lane-menu-member-filters-member").removeClass("lane-menu-member-filters-active"),d(".list:not(.mod-add)").removeClass("lane-menu-member-filters-hide"),y()}).appendTo(N),localStorage.getItem("filter_members:"+m()));$=$?JSON.parse($):{},F.each(function(){var e=this.title.match(/\(([^\)]+)\)$/)[1],a=d("<div/>").addClass("lane-menu-member-filters-member").append(d(this).clone().attr("class","")).data("name",e);$[e]&&a.addClass("lane-menu-member-filters-active"),L.append(a)}),L.delegate(".lane-menu-member-filters-member","click",function(){var e=d(this),a=e.data("name");e.is(".lane-menu-member-filters-active")?(e.removeClass("lane-menu-member-filters-active"),delete $[a]):(e.addClass("lane-menu-member-filters-active"),$[a]=!0),y()});var x=d(".list:not(.mod-add)"),O=d("<menu/>").addClass("lane-menu-lane-filters").appendTo(f),j=d("<h2>").addClass("lane-menu-headline").html("Lane Filters").appendTo(O),J=(d("<button>(Clear)</button>").bind("click",function(){J={},d(".lane-menu-lane-filters-lane").removeClass("lane-menu-lane-filters-active"),y()}).appendTo(j),localStorage.getItem("filter_lanes:"+m()));J=J?JSON.parse(J):{},x.each(function(){var e=d(this),a="lane"+(new Date).getTime();e.data("laneid",a);var l=e.find(".list-header-name").text(),t=d("<div/>").addClass("lane-menu-lane-filters-lane").html(l).data("lane",e);J[l]&&(t.addClass("lane-menu-lane-filters-active"),e.addClass("lane-menu-member-filters-hide")),O.append(t)}),O.delegate(".lane-menu-lane-filters-lane","click",function(){var e=d(this),a=e.data("lane"),l=a.find(".list-header-name").text();e.is(".lane-menu-lane-filters-active")?(a.removeClass("lane-menu-member-filters-hide"),e.removeClass("lane-menu-lane-filters-active"),delete J[l]):(a.addClass("lane-menu-member-filters-hide"),e.addClass("lane-menu-lane-filters-active"),J[l]=!0),y()}),$label_filters=d("<menu/>").addClass("lane-menu-label-filters").insertBefore(O);var D=d("<h2>").addClass("lane-menu-headline").html("Label Filters").appendTo($label_filters),A=(d("<button>(Clear)</button>").bind("click",function(){A={},d(".lane-menu-label-filters-label").removeClass("lane-menu-label-filters-active"),y()}).appendTo(D),localStorage.getItem("filter_labels:"+m()));A=A?JSON.parse(A):{};var E=function(){$label_filters.delegate(".lane-menu-label-filters-label","click",function(){var e=d(this),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");e.is(".lane-menu-label-filters-active")?(e.removeClass("lane-menu-label-filters-active"),delete A[a]):(e.addClass("lane-menu-label-filters-active"),A[a]=!0),y()})};d.when(c(".edit-labels-pop-over .card-label",1e3)).then(function(){var e=d(".js-labels-list .card-label");e.each(function(){var e=d(this).clone().addClass("lane-menu-label-filters-label"),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");A[a]&&e.addClass("lane-menu-label-filters-active"),e.find("*").detach(),$label_filters.append(e)}),d(".js-pop-widget-view").click(),E(),W()}),d(".js-open-labels").click();var W=function(){var a;e.bind("DOMNodeInserted DOMNodeRemoved",function(e){(e.target.className.match(/js-member-on-card-menu/)||e.target.className.match(/list-card/))&&(clearTimeout(a),a=setTimeout(y,1e3))});var l=I.width();t.css({"padding-left":l+10}),I.css({left:-1*(l+10)});var n=setInterval(function(){I.parent().length||(I.remove(),clearInterval(n),u())},500);y()}})}(window.jQuery)};u()}();