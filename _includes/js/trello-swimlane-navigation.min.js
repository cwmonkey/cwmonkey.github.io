!function(){var e,a,l,t,n,s,i,r,d=($(window),!1),m='<link rel="stylesheet" id="trello-swimlane-navigation-css"/>';$css=$(m).appendTo("head"),$css.attr({href:window.cwmBookmarkletUrl+"/trello-swimlane-navigation.css?2"});var o=function(){var e=document.location.pathname.split("/");return"b"!=e[1]?null:e[2]},c=function(){return"undefined"==typeof jQuery?void setTimeout(c,500):void function(m){m(function(){if(m.fn.tooltip||(!function(e){var a,l,t=e("body"),n=e(window),s="tooltip",i="tooltip",r="tooltipShown",d=e("<span/>").addClass(i).attr("id",s).css({position:"absolute"}),m=e("<span/>").addClass(i+"-text").appendTo(d),o=e("<span/>").addClass(i+"-arrow").appendTo(d),c=function(){var i=e(this),c=i.data("title")||this.title;if(c){a&&!a.attr("title")&&a.attr({"aria-describedby":"",title:a.data("title")}),a=i,clearTimeout(l),m.html(c),i.data("title",c).attr({title:"","aria-describedby":s}),d.css({left:"",width:""});var u=i.offset(),f=i.outerWidth(),v=i.outerHeight();d.appendTo(t);var h=d.outerWidth();d.css("width",h);var b=u.left+f/2-h/2;if(0>b?(o.css("left",b),b=0):o.css("left",0),d.css({left:b,top:u.top+v}).addClass(r),b+d.outerWidth()>n.width()){var p=b+d.outerWidth()-n.width();d.css("left",b-p),o.css("left",p)}}},u=function(){clearTimeout(l),l=setTimeout(function(){a&&(a.attr({"aria-describedby":"",title:a.data("title")}),d.removeClass(r))},10)};e.fn.tooltip=function(){var a=this.selector,l=function(){var l=!1;t.bind("mousemove",function(t){if(l)return void(l=!1);var n=e(t.target).closest(a);n.length?c.call(n[0]):u()}).bind("mousedown mouseup",function(){l=!0,u()})};return t.length?l():e(function(){l()}),this}}(window.jQuery),m(".member-avatar, .member-initials, .lane-menu-member-filters-member [title]").tooltip()),i=m("body"),e=m("#board"),l=m(".board-canvas"),t=m(".board-main-content"),r=localStorage.getItem("lane-menu-hide"),r&&t.addClass("lane-menu-hide"),a=m(".board-wrapper"),O=e.find(".list"),n=e.find(".list-card"),s=m("#trello-swimlane-navigation-css"),!(s.length&&("loaded"==s.css("content")||'"loaded"'==s.css("content")||"'loaded'"==s.css("content"))&&t.length&&a.length&&l.length&&e.length&&O.length&&n.length&&o()))return void setTimeout(c,500);m(".js-show-extra-members").trigger("click");var u=m("<div/>").addClass("lane-menu u-fancy-scrollbar"),f=function(){var e=S.width();t.css({"padding-left":e+10}),S.css({left:-1*(e+10)})},v=function(e){var a=e.data("hide-key"),l=localStorage.getItem(a+":"+o()),t=e.find(".lane-menu-headline").eq(0),n=t.text();t.html("");m("<button/>").html("- "+n).attr("title","Hide").addClass("lane-menu-hide").prependTo(t),m("<button/>").html("+ "+n).attr("title","Show").addClass("lane-menu-show").prependTo(t);l&&e.addClass("lane-menu-hidden")};u.delegate(".lane-menu-show","click",function(){var e=m(this).closest("menu"),a=e.data("hide-key");e.removeClass("lane-menu-hidden"),localStorage.removeItem(a+":"+o()),f()}).delegate(".lane-menu-hide","click",function(){var e=m(this).closest("menu"),a=e.data("hide-key");e.addClass("lane-menu-hidden"),localStorage.setItem(a+":"+o(),1),f()});{var h=m("<menu/>").addClass("lane-menu-nav").data("hide-key","hide_lane_nav").appendTo(u);m("<h2/>").addClass("lane-menu-headline").html("Navigation").appendTo(h)}v(h);var b=m("<div/>").addClass("lane-menu-content").appendTo(h),p=localStorage.getItem("order:"+o()),C=null;if(p&&(p=JSON.parse(p),C={}),F=m(".js-list-board-members"),O.each(function(){var e=m(this),a=e.find(".list-header-name").text();if(a){var l=a.split(/[ \-]/),t=l[0],n=F.find('img[alt^="'+a+'"], img[alt^="'+a.toLowerCase()+'"], .member-initials[title^="'+a+'"], .member-initials[title^="'+a.toLowerCase()+'"]');n.length||(n=F.find('img[alt^="'+t+'"], img[alt^="'+t.toLowerCase()+'"], .member-initials[title^="'+t+'"], .member-initials[title^="'+t.toLowerCase()+'"]'));var s=m("<button/>").addClass("lane-menu-nav-item").html('<span class="lane-menu-name">'+a+"</span>");n.length&&s.prepend(n.eq(0).clone()),s.data("target",e),p?C[a]=s:b.append(s)}}),p){for(var g=0;g<p.length;g++){var w=C[p[g]];b.append(w),C[p[g]]=""}for(var T in C)C.hasOwnProperty(T)&&""!=C[T]&&b.append(C[T])}var S=m("<div/>").addClass("lane-menu-wrapper");S.append(u);m('<a href="#" class="lane-menu-toggle dark-hover js-hide-sidebar" title="Show/hide swimlane navbar."><span class="icon-sm icon-forward lane-menu-open"></span><span class="icon-sm icon-forward lane-menu-closed"></span></a>').bind("click",function(e){e.preventDefault(),t.is(".lane-menu-hide")?(t.removeClass("lane-menu-hide"),localStorage.removeItem("lane-menu-hide")):(t.addClass("lane-menu-hide"),localStorage.setItem("lane-menu-hide",1))}).prependTo(S);if(t.prepend(S),b.delegate(".lane-menu-nav-item","click",function(a){a.preventDefault();var l=m(this),t=l.data("target"),n=t.position().left+e.scrollLeft();e.animate({scrollLeft:n},"fast"),localStorage.setItem("scrollToLeft",n)}).sortable({items:"> .lane-menu-nav-item",cancel:"",stop:function(){var e=u.find(".lane-menu-nav-item"),a=[];e.each(function(){var e=m(this);a.push(e.find(".lane-menu-name").text())}),localStorage.setItem("order:"+o(),JSON.stringify(a))}}).disableSelection(),!d){d=!0;var k=!1;e.bind("scroll",function(){k||(k=!0,setTimeout(function(){localStorage.setItem("scrollToLeft",e.scrollLeft()),k=!1},100))});var y=localStorage.getItem("scrollToLeft");y&&e.animate({scrollLeft:y},"fast")}{var I=function(){var a=!1,l=!1;m(".list-card").removeClass("lane-menu-member-filters-show");for(g in L)l=!0,a=!0,m('.list-card:has([title$="('+g+')"])').addClass("lane-menu-member-filters-show");m(".list-card:has(.list-card-members:empty)").addClass("lane-menu-member-no-members"),m(".list-card:not(:has(.list-card-members:empty))").removeClass("lane-menu-member-no-members"),l?e.addClass("lane-menu-member-filters-filtered"):e.removeClass("lane-menu-member-filters-filtered"),localStorage.setItem("filter_members:"+o(),JSON.stringify(L));var t=!1;m(".lane").removeClass("lane-menu-member-filters-hide");for(g in J){t=!0;break}t?e.addClass("lane-menu-lane-filters-filtered"):e.removeClass("lane-menu-lane-filters-filtered"),localStorage.setItem("filter_lanes:"+o(),JSON.stringify(J));var n=!1;m(".list-card").removeClass("lane-menu-label-filters-show");for(g in A)n=!0,a=!0,m('.list-card:has([title="'+g+'"])').addClass("lane-menu-label-filters-show");n?e.addClass("lane-menu-label-filters-filtered"):e.removeClass("lane-menu-label-filters-filtered"),localStorage.setItem("filter_labels:"+o(),JSON.stringify(A)),a?i.addClass("lane-menu-cards-filtered"):i.removeClass("lane-menu-cards-filtered")},_=m("<h2>").addClass("lane-menu-headline").html("Filters").appendTo(u),F=(m("<button>(Clear All Filters)</button>").bind("click",function(){L={},J={},A={},m(".lane-menu-member-filters-member").removeClass("lane-menu-member-filters-active"),m(".lane-menu-lane-filters-lane").removeClass("lane-menu-lane-filters-active"),m(".list:not(.mod-add)").removeClass("lane-menu-member-filters-hide"),m(".lane-menu-label-filters-label").removeClass("lane-menu-label-filters-active"),I()}).appendTo(_),m(".js-list-board-members .member :first-child")),N=m("<menu/>").addClass("lane-menu-member-filters").data("hide-key","hide_member_filters").appendTo(u);m("<h2>").addClass("lane-menu-headline").html("Member Filters").appendTo(N)}v(N);var x=m("<div/>").addClass("lane-menu-content").appendTo(N),L=(m("<button>(Clear)</button>").bind("click",function(){L={},m(".lane-menu-member-filters-member").removeClass("lane-menu-member-filters-active"),m(".list:not(.mod-add)").removeClass("lane-menu-member-filters-hide"),I()}).appendTo(x),localStorage.getItem("filter_members:"+o()));L=L?JSON.parse(L):{},F.each(function(){var e=this.title.match(/\(([^\)]+)\)$/)[1],a=m("<div/>").addClass("lane-menu-member-filters-member").append(m(this).clone().attr("class","")).data("name",e);L[e]&&a.addClass("lane-menu-member-filters-active"),x.append(a)}),x.delegate(".lane-menu-member-filters-member","click",function(){var e=m(this),a=e.data("name");e.is(".lane-menu-member-filters-active")?(e.removeClass("lane-menu-member-filters-active"),delete L[a]):(e.addClass("lane-menu-member-filters-active"),L[a]=!0),I()});{var O=m(".list:not(.mod-add)"),j=m("<menu/>").addClass("lane-menu-lane-filters").data("hide-key","hide_lane_filters").appendTo(u);m("<h2>").addClass("lane-menu-headline").html("Lane Filters").appendTo(j)}v(j);var $=m("<div/>").addClass("lane-menu-content").appendTo(j),J=(m("<button>(Clear)</button>").bind("click",function(){J={},m(".lane-menu-lane-filters-lane").removeClass("lane-menu-lane-filters-active"),I()}).appendTo($),localStorage.getItem("filter_lanes:"+o()));J=J?JSON.parse(J):{},O.each(function(){var e=m(this),a="lane"+(new Date).getTime();e.data("laneid",a);var l=e.find(".list-header-name").text(),t=m("<div/>").addClass("lane-menu-lane-filters-lane").html(l).data("lane",e);J[l]&&(t.addClass("lane-menu-lane-filters-active"),e.addClass("lane-menu-member-filters-hide")),$.append(t)}),$.delegate(".lane-menu-lane-filters-lane","click",function(){var e=m(this),a=e.data("lane"),l=a.find(".list-header-name").text();e.is(".lane-menu-lane-filters-active")?(a.removeClass("lane-menu-member-filters-hide"),e.removeClass("lane-menu-lane-filters-active"),delete J[l]):(a.addClass("lane-menu-member-filters-hide"),e.addClass("lane-menu-lane-filters-active"),J[l]=!0),I()}),$label_filters=m("<menu/>").addClass("lane-menu-label-filters").data("hide-key","hide_label_filters").insertBefore(j);m("<h2>").addClass("lane-menu-headline").html("Label Filters").appendTo($label_filters);v($label_filters);var D=m("<div/>").addClass("lane-menu-content").appendTo($label_filters),A=(m("<button>(Clear)</button>").bind("click",function(){A={},m(".lane-menu-label-filters-label").removeClass("lane-menu-label-filters-active"),I()}).appendTo(D),localStorage.getItem("filter_labels:"+o()));A=A?JSON.parse(A):{};var M=function(){D.delegate(".lane-menu-label-filters-label","click",function(){var e=m(this),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");e.is(".lane-menu-label-filters-active")?(e.removeClass("lane-menu-label-filters-active"),delete A[a]):(e.addClass("lane-menu-label-filters-active"),A[a]=!0),I()})};m(".js-open-more").click(),m(".js-open-labels").click();var E,W,Q=function(){E.bind("DOMNodeInserted",B);var e=m(".js-labels-list .card-label");e.each(function(){var e=m(this).clone().addClass("lane-menu-label-filters-label"),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");A[a]&&e.addClass("lane-menu-label-filters-active"),e.find("*").detach(),D.append(e)}),m(".js-pop-widget-view").click().click(),M(),H()},q=5e3,B=function(){clearTimeout(W),W=setTimeout(Q,q),q=100};B(),E=m(".edit-labels-pop-over").bind("DOMNodeInserted",B);var H=function(){var a;e.bind("DOMNodeInserted DOMNodeRemoved",function(e){(e.target.className.match(/js-member-on-card-menu/)||e.target.className.match(/list-card/))&&(clearTimeout(a),a=setTimeout(I,1e3))}),f();var l=setInterval(function(){S.parent().length||(S.remove(),clearInterval(l),c())},500);I()}})}(window.jQuery)};c()}();