!function(){var e,a,t,l,n,i,s,r,d=($(window),!1),o='<link rel="stylesheet" id="trello-swimlane-navigation-css"/>';$css=$(o).appendTo("head"),$css.attr({href:window.cwmBookmarkletUrl+"/trello-swimlane-navigation.css?2"});var m=function(){var e=document.location.pathname.split("/");return"b"!=e[1]?null:e[2]},c=function(){return"undefined"==typeof jQuery?void setTimeout(c,500):void function(o){o(function(){if(o.fn.tooltip||(!function(e){var a,t=e("body"),l=e(window),n="tooltip",i="tooltip",s="tooltipShown",r=e("<span/>").addClass(i).attr("id",n).css({position:"absolute"}),d=e("<span/>").addClass(i+"-text").appendTo(r),o=e("<span/>").addClass(i+"-arrow").appendTo(r),m=function(){var i=e(this),m=i.data("title")||this.title;if(m){clearTimeout(a),d.html(m),i.data("title",m).attr({title:"","aria-describedby":n}),r.css({left:"",width:""});var c=i.offset(),u=i.outerWidth(),f=i.outerHeight();r.appendTo(t);var h=r.outerWidth();r.css("width",h);var v=c.left+u/2-h/2;if(0>v?(o.css("left",v),v=0):o.css("left",0),r.css({left:v,top:c.top+f}).addClass(s),v+r.outerWidth()>l.width()){var p=v+r.outerWidth()-l.width();r.css("left",v-p),o.css("left",p)}}},c=function(){var t=e(this);clearTimeout(a),a=setTimeout(function(){t.attr("aria-describedby",""),r.removeClass(s)},10)};e.fn.tooltip=function(){var a=this.selector,l=function(){var l=!1;t.bind("mousemove",function(t){if(l)return void(l=!1);var n=e(t.target).closest(a);n.length?m.call(n[0]):c()}).bind("mousedown mouseup",function(){l=!0,c()})};return t.length?l():e(function(){l()}),this}}(window.jQuery),o(".member-avatar, .member-initials, .lane-menu-member-filters-member [title]").tooltip()),s=o("body"),e=o("#board"),t=o(".board-canvas"),l=o("#content"),r=localStorage.getItem("lane-menu-hide"),r&&l.addClass("lane-menu-hide"),a=o(".board-wrapper"),L=e.find(".list"),n=e.find(".list-card"),i=o("#trello-swimlane-navigation-css"),!(i.length&&("loaded"==i.css("content")||'"loaded"'==i.css("content"))&&l.length&&a.length&&t.length&&e.length&&L.length&&n.length&&m()))return void setTimeout(c,500);o(".js-show-extra-members").trigger("click");var u=o("<div/>").addClass("lane-menu u-fancy-scrollbar"),f=function(){var e=S.width();l.css({"padding-left":e+10}),S.css({left:-1*(e+10)})},h=function(e){var a=e.data("hide-key"),t=localStorage.getItem(a+":"+m()),l=e.find(".lane-menu-headline").eq(0),n=l.text();l.html("");o("<button/>").html("- "+n).attr("title","Hide").addClass("lane-menu-hide").prependTo(l),o("<button/>").html("+ "+n).attr("title","Show").addClass("lane-menu-show").prependTo(l);t&&e.addClass("lane-menu-hidden")};u.delegate(".lane-menu-show","click",function(){var e=o(this).closest("menu"),a=e.data("hide-key");e.removeClass("lane-menu-hidden"),localStorage.removeItem(a+":"+m()),f()}).delegate(".lane-menu-hide","click",function(){var e=o(this).closest("menu"),a=e.data("hide-key");e.addClass("lane-menu-hidden"),localStorage.setItem(a+":"+m(),1),f()});{var v=o("<menu/>").addClass("lane-menu-nav").data("hide-key","hide_lane_nav").appendTo(u);o("<h2/>").addClass("lane-menu-headline").html("Navigation").appendTo(v)}h(v);var p=o("<div/>").addClass("lane-menu-content").appendTo(v),b=localStorage.getItem("order:"+m()),g=null;if(b&&(b=JSON.parse(b),g={}),_=o(".board-widget-members"),L.each(function(){var e=o(this),a=e.find(".list-header-name").text();if(a){var t=a.split(/[ \-]/),l=t[0],n=_.find('img[alt^="'+a+'"], img[alt^="'+a.toLowerCase()+'"], .member-initials[title^="'+a+'"], .member-initials[title^="'+a.toLowerCase()+'"]');n.length||(n=_.find('img[alt^="'+l+'"], img[alt^="'+l.toLowerCase()+'"], .member-initials[title^="'+l+'"], .member-initials[title^="'+l.toLowerCase()+'"]'));var i=o("<button/>").addClass("lane-menu-nav-item").html('<span class="lane-menu-name">'+a+"</span>");n.length&&i.prepend(n.eq(0).clone()),i.data("target",e),b?g[a]=i:p.append(i)}}),b){for(var C=0;C<b.length;C++){var w=g[b[C]];p.append(w),g[b[C]]=""}for(var T in g)g.hasOwnProperty(T)&&""!=g[T]&&p.append(g[T])}var S=o("<div/>").addClass("lane-menu-wrapper");S.append(u);o('<a href="#" class="lane-menu-toggle dark-hover js-hide-sidebar" title="Show/hide swimlane navbar."><span class="icon-sm icon-forward lane-menu-open"></span><span class="icon-sm icon-forward lane-menu-closed"></span></a>').bind("click",function(e){e.preventDefault(),l.is(".lane-menu-hide")?(l.removeClass("lane-menu-hide"),localStorage.removeItem("lane-menu-hide")):(l.addClass("lane-menu-hide"),localStorage.setItem("lane-menu-hide",1))}).prependTo(S);if(l.prepend(S),p.delegate(".lane-menu-nav-item","click",function(a){a.preventDefault();var t=o(this),l=t.data("target"),n=l.position().left+e.scrollLeft();e.animate({scrollLeft:n},"fast"),localStorage.setItem("scrollToLeft",n)}).sortable({items:"> .lane-menu-nav-item",cancel:"",stop:function(){var e=u.find(".lane-menu-nav-item"),a=[];e.each(function(){var e=o(this);a.push(e.find(".lane-menu-name").text())}),localStorage.setItem("order:"+m(),JSON.stringify(a))}}).disableSelection(),!d){d=!0;var k=!1;e.bind("scroll",function(){k||(k=!0,setTimeout(function(){localStorage.setItem("scrollToLeft",e.scrollLeft()),k=!1},100))});var y=localStorage.getItem("scrollToLeft");y&&e.animate({scrollLeft:y},"fast")}{var I=function(){var a=!1;o(".list-card").removeClass("lane-menu-member-filters-show");for(C in x)a=!0,o('.list-card:has([title$="('+C+')"])').addClass("lane-menu-member-filters-show");a?e.addClass("lane-menu-member-filters-filtered"):e.removeClass("lane-menu-member-filters-filtered"),localStorage.setItem("filter_members:"+m(),JSON.stringify(x));var t=!1;o(".lane").removeClass("lane-menu-member-filters-hide");for(C in j){t=!0;break}t?e.addClass("lane-menu-lane-filters-filtered"):e.removeClass("lane-menu-lane-filters-filtered"),localStorage.setItem("filter_lanes:"+m(),JSON.stringify(j));var l=!1;o(".list-card").removeClass("lane-menu-label-filters-show");for(C in D)l=!0,o('.list-card:has([title="'+C+'"])').addClass("lane-menu-label-filters-show");l?e.addClass("lane-menu-label-filters-filtered"):e.removeClass("lane-menu-label-filters-filtered"),localStorage.setItem("filter_labels:"+m(),JSON.stringify(D))},_=o(".board-widget-members .member :first-child"),F=o("<menu/>").addClass("lane-menu-member-filters").data("hide-key","hide_member_filters").appendTo(u);o("<h2>").addClass("lane-menu-headline").html("Member Filters").appendTo(F)}h(F);var N=o("<div/>").addClass("lane-menu-content").appendTo(F),x=(o("<button>(Clear)</button>").bind("click",function(){x={},o(".lane-menu-member-filters-member").removeClass("lane-menu-member-filters-active"),o(".list:not(.mod-add)").removeClass("lane-menu-member-filters-hide"),I()}).appendTo(N),localStorage.getItem("filter_members:"+m()));x=x?JSON.parse(x):{},_.each(function(){var e=this.title.match(/\(([^\)]+)\)$/)[1],a=o("<div/>").addClass("lane-menu-member-filters-member").append(o(this).clone().attr("class","")).data("name",e);x[e]&&a.addClass("lane-menu-member-filters-active"),N.append(a)}),N.delegate(".lane-menu-member-filters-member","click",function(){var e=o(this),a=e.data("name");e.is(".lane-menu-member-filters-active")?(e.removeClass("lane-menu-member-filters-active"),delete x[a]):(e.addClass("lane-menu-member-filters-active"),x[a]=!0),I()});{var L=o(".list:not(.mod-add)"),O=o("<menu/>").addClass("lane-menu-lane-filters").data("hide-key","hide_lane_filters").appendTo(u);o("<h2>").addClass("lane-menu-headline").html("Lane Filters").appendTo(O)}h(O);var $=o("<div/>").addClass("lane-menu-content").appendTo(O),j=(o("<button>(Clear)</button>").bind("click",function(){j={},o(".lane-menu-lane-filters-lane").removeClass("lane-menu-lane-filters-active"),I()}).appendTo($),localStorage.getItem("filter_lanes:"+m()));j=j?JSON.parse(j):{},L.each(function(){var e=o(this),a="lane"+(new Date).getTime();e.data("laneid",a);var t=e.find(".list-header-name").text(),l=o("<div/>").addClass("lane-menu-lane-filters-lane").html(t).data("lane",e);j[t]&&(l.addClass("lane-menu-lane-filters-active"),e.addClass("lane-menu-member-filters-hide")),$.append(l)}),$.delegate(".lane-menu-lane-filters-lane","click",function(){var e=o(this),a=e.data("lane"),t=a.find(".list-header-name").text();e.is(".lane-menu-lane-filters-active")?(a.removeClass("lane-menu-member-filters-hide"),e.removeClass("lane-menu-lane-filters-active"),delete j[t]):(a.addClass("lane-menu-member-filters-hide"),e.addClass("lane-menu-lane-filters-active"),j[t]=!0),I()}),$label_filters=o("<menu/>").addClass("lane-menu-label-filters").data("hide-key","hide_label_filters").insertBefore(O);o("<h2>").addClass("lane-menu-headline").html("Label Filters").appendTo($label_filters);h($label_filters);var J=o("<div/>").addClass("lane-menu-content").appendTo($label_filters),D=(o("<button>(Clear)</button>").bind("click",function(){D={},o(".lane-menu-label-filters-label").removeClass("lane-menu-label-filters-active"),I()}).appendTo(J),localStorage.getItem("filter_labels:"+m()));D=D?JSON.parse(D):{};var M=function(){J.delegate(".lane-menu-label-filters-label","click",function(){var e=o(this),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");e.is(".lane-menu-label-filters-active")?(e.removeClass("lane-menu-label-filters-active"),delete D[a]):(e.addClass("lane-menu-label-filters-active"),D[a]=!0),I()})};o(".js-open-labels").click();var A,E,W=function(){A.bind("DOMNodeInserted",q);var e=o(".js-labels-list .card-label");e.each(function(){var e=o(this).clone().addClass("lane-menu-label-filters-label"),a=e.text().replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");D[a]&&e.addClass("lane-menu-label-filters-active"),e.find("*").detach(),J.append(e)}),o(".js-pop-widget-view").click(),M(),B()},Q=5e3,q=function(){clearTimeout(E),E=setTimeout(W,Q),Q=100};q(),A=o(".edit-labels-pop-over").bind("DOMNodeInserted",q);var B=function(){var a;e.bind("DOMNodeInserted DOMNodeRemoved",function(e){(e.target.className.match(/js-member-on-card-menu/)||e.target.className.match(/list-card/))&&(clearTimeout(a),a=setTimeout(I,1e3))}),f();var t=setInterval(function(){S.parent().length||(S.remove(),clearInterval(t),c())},500);I()}})}(window.jQuery)};c()}();