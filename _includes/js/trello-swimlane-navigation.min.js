!function(){var e,a,t,l,n,s,r,i=!1,m=$("body"),o='<link rel="stylesheet" id="trello-swimlane-navigation-css"/>';$css=$(o).appendTo("head"),$css.attr({href:window.cwmBookmarkletUrl+"/trello-swimlane-navigation.css?2"});var d=function(){return document.location.pathname.split("/")[2]};m.delegate(".lane-menu-toggle","click",function(e){e.preventDefault(),l.is(".lane-menu-hide")?(l.removeClass("lane-menu-hide"),localStorage.removeItem("lane-menu-hide")):(l.addClass("lane-menu-hide"),localStorage.setItem("lane-menu-hide",1))});var c=function(){return"undefined"==typeof jQuery?void setTimeout(c,500):void function(m){m(function(){if(e=m("#board"),t=m(".board-canvas"),l=m("#content"),r=localStorage.getItem("lane-menu-hide"),r&&l.addClass("lane-menu-hide"),a=m(".board-wrapper"),m(".js-show-extra-members").trigger("click"),y=e.find(".list"),n=e.find(".list-card"),s=m("#trello-swimlane-navigation-css"),!(s.length&&("loaded"==s.css("content")||'"loaded"'==s.css("content"))&&l.length&&a.length&&t.length&&e.length&&y.length&&n.length))return void setTimeout(c,500);var o=m("<menu/>").addClass("lane-menu u-fancy-scrollbar"),f=localStorage.getItem("order:"+d()),u=null;if(f&&(f=JSON.parse(f),u={}),I=m(".board-widget-members"),y.each(function(){var e=m(this),a=e.find(".list-header-name").text();if(a){var t=a.split(/[ \-]/),l=t[0],n=I.find('img[alt^="'+a+'"], img[alt^="'+a.toLowerCase()+'"], .member-initials[title^="'+a+'"], .member-initials[title^="'+a.toLowerCase()+'"]');n.length||(n=I.find('img[alt^="'+l+'"], img[alt^="'+l.toLowerCase()+'"], .member-initials[title^="'+l+'"], .member-initials[title^="'+l.toLowerCase()+'"]'));var s=m("<button/>").html('<span class="lane-menu-name">'+a+"</span>");n.length&&s.prepend(n.eq(0).clone()),s.data("target",e),f?u[a]=s:o.append(s)}}),f){for(var v=0;v<f.length;v++){var h=u[f[v]];o.append(h),u[f[v]]=""}for(var g in u)u.hasOwnProperty(g)&&""!=u[g]&&o.append(u[g])}var p=m("<div/>").addClass("lane-menu-wrapper");if(p.append('<a href="#" class="lane-menu-toggle dark-hover js-hide-sidebar" title="Show/hide swimlane navbar."><span class="icon-sm icon-forward lane-menu-open"></span><span class="icon-sm icon-forward lane-menu-closed"></span></a>').append(o),l.prepend(p),o.delegate("button","click",function(a){a.preventDefault();var t=m(this),l=t.data("target"),n=l.position().left+e.scrollLeft();e.animate({scrollLeft:n},"fast"),localStorage.setItem("scrollToLeft",n)}).sortable({items:"> button",cancel:"",stop:function(){var e=o.find("button"),a=[];e.each(function(){var e=m(this);a.push(e.find(".lane-menu-name").text())}),localStorage.setItem("order:"+d(),JSON.stringify(a))}}).disableSelection(),!i){i=!0;var b=!1;e.bind("scroll",function(){b||(b=!0,setTimeout(function(){localStorage.setItem("scrollToLeft",e.scrollLeft()),b=!1},100))});var C=localStorage.getItem("scrollToLeft");C&&e.animate({scrollLeft:C},"fast")}var w=function(){var a=!1;m(".list-card").removeClass("lane-menu-member-filters-show");for(v in k)a=!0,m('.list-card:has([title$="('+v+')"])').addClass("lane-menu-member-filters-show");a?e.addClass("lane-menu-member-filters-filtered"):e.removeClass("lane-menu-member-filters-filtered"),localStorage.setItem("filter_members:"+d(),JSON.stringify(k));var t=!1;m(".lane").removeClass("lane-menu-member-filters-hide");for(v in N){t=!0;break}t?e.addClass("lane-menu-lane-filters-filtered"):e.removeClass("lane-menu-lane-filters-filtered"),localStorage.setItem("filter_lanes:"+d(),JSON.stringify(N))},S=m("<h2>").addClass("lane-menu-headline").html("Filters"),I=m(".board-widget-members .member :first-child"),L=m("<div/>").addClass("lane-menu-member-filters"),k=localStorage.getItem("filter_members:"+d());k=k?JSON.parse(k):{},I.each(function(){var e=this.title.match(/\(([^\)]+)\)$/)[1],a=m("<div/>").addClass("lane-menu-member-filters-member").append(m(this).clone().attr("class","")).data("name",e);k[e]&&a.addClass("lane-menu-member-filters-active"),L.append(a)}),o.append(S,L),L.delegate(".lane-menu-member-filters-member","click",function(){var e=m(this),a=e.data("name");e.is(".lane-menu-member-filters-active")?(e.removeClass("lane-menu-member-filters-active"),delete k[a]):(e.addClass("lane-menu-member-filters-active"),k[a]=!0),w()});var y=m(".list:not(.mod-add)"),T=m("<div/>").addClass("lane-menu-lane-filters"),N=localStorage.getItem("filter_lanes:"+d());N=N?JSON.parse(N):{},y.each(function(){var e=m(this),a="lane"+(new Date).getTime();e.data("laneid",a);var t=e.find(".list-header-name").text(),l=m("<div/>").addClass("lane-menu-lane-filters-lane").html(t).data("lane",e);N[t]&&(l.addClass("lane-menu-lane-filters-active"),e.addClass("lane-menu-member-filters-hide")),T.append(l)}),o.append(T),T.delegate(".lane-menu-lane-filters-lane","click",function(){var e=m(this),a=e.data("lane"),t=a.find(".list-header-name").text();e.is(".lane-menu-lane-filters-active")?(a.removeClass("lane-menu-member-filters-hide"),e.removeClass("lane-menu-lane-filters-active"),delete N[t]):(a.addClass("lane-menu-member-filters-hide"),e.addClass("lane-menu-lane-filters-active"),N[t]=!0),w()}),w();var O;e.bind("DOMNodeInserted DOMNodeRemoved",function(e){e.target.className.match(/js-member-on-card-menu/)&&(clearTimeout(O),O=setTimeout(w,1e3))});var J=p.width();l.css({"padding-left":J+10}),p.css({left:-1*(J+10)});var $=setInterval(function(){p.parent().length||(p.remove(),clearInterval($),c())},500)})}(window.jQuery)};c()}();